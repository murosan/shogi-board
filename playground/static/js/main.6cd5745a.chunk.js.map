{"version":3,"sources":["img/components/columns/1.svg","img/components/columns/2.svg","img/components/columns/3.svg","img/components/columns/4.svg","img/components/columns/5.svg","img/components/columns/6.svg","img/components/columns/7.svg","img/components/columns/8.svg","img/components/columns/9.svg","img/components/rows/1.svg","img/components/rows/2.svg","img/components/rows/3.svg","img/components/rows/4.svg","img/components/rows/5.svg","img/components/rows/6.svg","img/components/rows/7.svg","img/components/rows/8.svg","img/components/rows/9.svg","img/components/buttons/configuration.svg","img/components/buttons/connect-to-engine.svg","img/components/buttons/copy-kifu.svg","img/components/buttons/next-five.svg","img/components/buttons/next-one.svg","img/components/buttons/prev-five.svg","img/components/buttons/prev-one.svg","img/components/buttons/reverse.svg","img/components/buttons/stop-engine.svg","store/impl/Config.ts","store/impl/DisplayState.ts","model/display/MockupState.ts","handler/game/captures.ts","model/shogi/Piece.ts","handler/game/piece.ts","handler/game/position.ts","model/shogi/Turn.ts","model/engine/Optoin.ts","infrastructure/ShogiBoardClient.ts","store/impl/EngineState.ts","model/engine/State.ts","model/kifu/History.ts","handler/kifu/changeIndex.ts","lib/strings.ts","lib/validatior/utils/getEmpties.ts","lib/validatior/utils/getFromNexts.ts","lib/validatior/utils/algorithm.ts","lib/validatior/utils/getWithDiff.ts","lib/validatior/pieces/hisha.ts","lib/validatior/pieces/kaku.ts","lib/validatior/getTargets.ts","lib/validatior/pieces/fu.ts","lib/validatior/pieces/kyou.ts","lib/validatior/pieces/kei.ts","lib/validatior/pieces/gin.ts","lib/validatior/pieces/kin.ts","lib/validatior/pieces/gyoku.ts","lib/validatior/pieces/uma.ts","lib/validatior/pieces/ryu.ts","handler/kifu/genKifuString.ts","handler/kifu/pushMove.ts","lib/validatior/utils/getGyokuPoint.ts","lib/validatior/utils/isPointed.ts","store/impl/GameState.ts","lib/validatior/utils/filterTargets.ts","handler/kifu/getCurrent.ts","model/kifu/Kifu.ts","model/shogi/PositionInit.ts","store/Store.ts","components/engine/info/Columns.tsx","components/engine/info/SideInfo.tsx","components/setting/WidthController.tsx","components/util/CloseButton.tsx","components/form/Button.tsx","components/engine/connection/form/Buttons.tsx","components/form/Check.tsx","components/engine/connection/form/Checks.tsx","components/engine/connection/form/Range.tsx","components/engine/connection/form/Ranges.tsx","components/form/Select.tsx","components/engine/connection/form/Selects.tsx","components/form/Text.tsx","components/engine/connection/form/Texts.tsx","components/engine/connection/Detail.tsx","components/util/Loader.tsx","components/engine/connection/List.tsx","components/engine/connection/Controller.tsx","components/setting/Setting.tsx","components/shogi/Cell.tsx","components/shogi/Board.tsx","handler/kifu/getAsString.ts","components/shogi/Buttons.tsx","components/shogi/Captures.tsx","components/shogi/LeftSide.tsx","components/shogi/Kifu.tsx","handler/dom/intoView.ts","components/shogi/RightSide.tsx","components/shogi/BoardArea.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","DefaultConfig","keys","paintTargets","serverURL","saveToLocalStorage","saveBoardWidth","appWidth","saveAppWidth","debounce","w","set","this","get","v","n","Number","isNaN","b","String","s","forEach","key","remove","value","localStorage","setItem","getItem","removeItem","observable","action","DefaultDisplayState","state","mockup","resizing","handle","cap","p","f","Error","map","count","index","promote","demote","Math","abs","canPromote","props","sourceRow","isPromotable","piece","rows","isInEnemyArea","includes","destRow","move","handleCaptures","turn","pos","slice","d","dest","row","column","i","increaseCaptures","source","decreaseCaptures","updatedCap0","cap0","updatedCap1","cap1","moveOnBoard","moveCount","moveBoardOnly","line","r","c","Button","name","_","Check","initial","default","Range","min","max","inputValue","toString","Select","vars","Text","ShogiBoardClient","engineName","_engineName","_serverURL","engineNameKey","updateRange","rng","a","post","updateText","txt","buildUrl","url","axios","res","data","m","buttons","Map","checks","ranges","selects","texts","Object","values","t","btn","chk","sel","current","resp","entries","sort","info","moves","length","pieceId","mp","isPromoted","push","e","k","id","shortid","generate","score","reverse","path","body","headers","withName","encodeURIComponent","query","DefaultEngineState","names","setState","sbclient","connect","getOptions","options","console","error","alert","disconnect","close","start","stop","result","setPosition","computed","isBranch","changeHistory","h","x","y","lastIndex","last","init","xPassesIfBranch","concat","undefined","branches","changeBranch","columns","invalidRows","invalidColumns","points","nexts","comp","find","pts","l","rowDiff","columnDiff","target","getEmpties","diffList","getWithDiff","getTargets","point","columnsOfContainingFu","col","invalidRow","nextRow","fu","diff","kyou","invalidRow1","invalidRow2","getFromNexts","kei","gin","kin","kaku","hisha","gyoku","kakuPoint","kakuTargets","targets","uma","hishaPoint","hishaTargets","ryu","genKifuString","base","prevDest","srow","scol","drow","dcol","pc","pieceString","dr","dc","targettings","position","findSamePieces","filter","some","isMulti","another","arow","acol","isAbove","isBelow","isLeft","additionalForTwo","moving","sameRow","sameCol","below","above","left","right","isRight","additional","pushToHistory","lastIsCurrent","pushToBranch","nextIndex","next","moveEquals","tail","createBranch","recursive","indexOfNewMove","findIndex","toHistory","isPointed","attacker","ignoreCheckLeaving","DefaultGameState","indexes","selected","currentMove","confirm","isPiece","clicked","cp","selectedAgain","moveTargets","ownerIsTurn","filtered","gp","getGyokuPoint","moved","isFu","isFromCapture","enemyGyoku","fuIsPointed","filteredEnemyGyokuTargets","filterTargets","moveAndUpdateState","prevDestination","old","moveProps","kifuStr","moveForKifu","str","kifu","meta","history","mustPromote","promoted","preserved","branchIndex","moveOrBranch","getCurrent","initPos","version","player","sente","gote","handicap","newKifu","DefaultStore","engineState","setServerURL","config","observe","gameState","change","updatePosition","newValue","StoreContext","createContext","observer","React","useContext","className","SideInfo","displayState","displayStateRef","useRef","configRef","useEffect","document","addEventListener","window","getSelection","removeAllRanges","setResizing","resizeOff","containerWidth","getElementById","clientWidth","clientX","setAppWidth","onMove","onMouseDown","CloseButton","one","two","onClick","width","height","x1","y1","x2","y2","stroke","strokeWidth","label","elms","Array","from","option","updateButton","type","onChange","checked","htmlFor","data-checked","data-unchecked","setValue","updateCheck","labelText","placeholder","required","opts","updateSelect","allowEmpty","classes","join","strElms","disconnectBtn","startBtn","startThinking","then","closeMockup","fetchInterval","catch","interval","getResult","setResult","Loader","store","latestEngineState","list","setNames","err","msg","engineNames","loader","setCurrentEngine","child","setMockupState","setPaintTargets","setSaveToLocalStorage","setSaveBoardWidth","inRange","style","getPiece","isTurn","isTargeted","rv","rowInRange","colInRange","isTop","isStar","isSelected","rvp","getClassName","bgImg","backgroundImage","Column1Img","Column2Img","Column3Img","Column4Img","Column5Img","Column6Img","Column7Img","Column8Img","Column9Img","Row1Img","Row2Img","Row3Img","Row4Img","Row5Img","Row6Img","Row7Img","Row8Img","Row9Img","click","cf","isReversed","isGote","renderConfirm","clickPiece","idx","renderMockup","getAsString","getRec","kc","prevOne","nextOne","prevFive","nextFive","skipKifu","clickKifu","engineOnClick","connectToEngine","stopThinking","PrevOneImg","NextOneImg","PrevFiveImg","NextFiveImg","ReverseImg","data-clipboard-text","CopyKifuImg","StopEngineImg","ConnectToEngineImg","ConfigurationImg","captures","isLeftSide","cells","children","selectedClass","getSelectedClass","isTurnClass","sideNumber","captureClass","caps","scrollIntoViewIfNeeded","intoView","renderKifu","flatMap","main","head","rest","otherHeadsDom","kifuText","restDom","renderMove","renderBranch","BoardArea","isThinking","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","onUpdate","onSuccess","ReactDOM","render","ClipboardJS","URL","process","href","origin","fetch","response","contentType","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.6cd5745a.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/1.53ae04ea.svg\";","module.exports = __webpack_public_path__ + \"static/media/2.97f27bd3.svg\";","module.exports = __webpack_public_path__ + \"static/media/3.b1be70d0.svg\";","module.exports = __webpack_public_path__ + \"static/media/4.3a3645e1.svg\";","module.exports = __webpack_public_path__ + \"static/media/5.96880164.svg\";","module.exports = __webpack_public_path__ + \"static/media/6.eed8b457.svg\";","module.exports = __webpack_public_path__ + \"static/media/7.f7756286.svg\";","module.exports = __webpack_public_path__ + \"static/media/8.091df296.svg\";","module.exports = __webpack_public_path__ + \"static/media/9.2a50e523.svg\";","module.exports = __webpack_public_path__ + \"static/media/1.6deb9f45.svg\";","module.exports = __webpack_public_path__ + \"static/media/2.d7945250.svg\";","module.exports = __webpack_public_path__ + \"static/media/3.41251812.svg\";","module.exports = __webpack_public_path__ + \"static/media/4.b9435843.svg\";","module.exports = __webpack_public_path__ + \"static/media/5.617112e9.svg\";","module.exports = __webpack_public_path__ + \"static/media/6.d05bf0e7.svg\";","module.exports = __webpack_public_path__ + \"static/media/7.b426a2a3.svg\";","module.exports = __webpack_public_path__ + \"static/media/8.33901adb.svg\";","module.exports = __webpack_public_path__ + \"static/media/9.f4885e44.svg\";","module.exports = __webpack_public_path__ + \"static/media/configuration.3bb39912.svg\";","module.exports = __webpack_public_path__ + \"static/media/connect-to-engine.83c1b041.svg\";","module.exports = __webpack_public_path__ + \"static/media/copy-kifu.6a0a1831.svg\";","module.exports = __webpack_public_path__ + \"static/media/next-five.af1deb21.svg\";","module.exports = __webpack_public_path__ + \"static/media/next-one.23a7a57e.svg\";","module.exports = __webpack_public_path__ + \"static/media/prev-five.b79ad6a0.svg\";","module.exports = __webpack_public_path__ + \"static/media/prev-one.8e9ec7d7.svg\";","module.exports = __webpack_public_path__ + \"static/media/reverse.13ea1c9a.svg\";","module.exports = __webpack_public_path__ + \"static/media/stop-engine.d8f88815.svg\";","import debounce from 'lodash.debounce'\nimport { action, observable } from 'mobx'\nimport { Config } from '../Config'\n\nexport class DefaultConfig implements Config {\n  @observable paintTargets: boolean\n  @observable serverURL: string\n  @observable saveToLocalStorage: boolean\n  @observable saveBoardWidth: boolean\n  @observable appWidth: number | null\n\n  private readonly keys = {\n    paintTargets: 'paintTargets',\n    serverURL: 'serverURL',\n    saveToLocalStorage: 'saveToLocalStorage',\n    saveBoardWidth: 'saveBoardWidth',\n    appWidth: 'appWidth',\n  }\n\n  constructor() {\n    const {\n      paintTargets,\n      serverURL,\n      saveToLocalStorage,\n      saveBoardWidth,\n      appWidth,\n    } = this.keys\n    this.paintTargets = !(this.get(paintTargets) === 'false')\n    this.serverURL = this.get(serverURL) || ''\n    this.saveToLocalStorage = this.get(saveToLocalStorage) === 'true'\n    this.saveBoardWidth = this.get(saveBoardWidth) === 'true'\n    this.appWidth = (() => {\n      if (!this.saveBoardWidth) return null\n\n      const v = this.get(appWidth)\n      if (!v) return null\n\n      const n = Number(v)\n      if (isNaN(n)) return null\n      return n\n    })()\n  }\n\n  @action\n  async setPaintTargets(b: boolean): Promise<void> {\n    this.paintTargets = b\n    if (this.saveToLocalStorage) this.set(this.keys.paintTargets, String(b))\n  }\n\n  @action\n  async setServerURL(s: string): Promise<void> {\n    this.serverURL = s\n    if (this.saveToLocalStorage) this.set(this.keys.serverURL, s)\n  }\n\n  @action\n  async setSaveToLocalStorage(b: boolean): Promise<void> {\n    this.saveToLocalStorage = b\n    const { saveToLocalStorage, serverURL, paintTargets } = this.keys\n\n    if (this.saveToLocalStorage) {\n      this.set(saveToLocalStorage, `${b}`)\n      this.set(serverURL, this.serverURL)\n      this.set(paintTargets, `${this.paintTargets}`)\n      return\n    }\n\n    // false なら削除する\n    const keys = [saveToLocalStorage, serverURL, paintTargets]\n    keys.forEach(key => this.remove(key))\n  }\n\n  @action\n  async setSaveBoardWidth(b: boolean): Promise<void> {\n    this.saveBoardWidth = b\n    if (!b) {\n      this.remove(this.keys.saveBoardWidth)\n      this.remove(this.keys.appWidth)\n      return\n    }\n    this.set(this.keys.saveBoardWidth, 'true')\n    const w = this.appWidth\n    if (w) this.saveAppWidth(w)\n  }\n\n  @action\n  async setAppWidth(w?: number): Promise<void> {\n    if (!w) {\n      this.appWidth = null\n      this.remove(this.keys.appWidth)\n      return\n    }\n    this.appWidth = w\n    if (this.saveBoardWidth) this.saveAppWidth(w)\n  }\n\n  saveAppWidth = debounce(\n    (w: number) => this.set(this.keys.appWidth, `${w}`),\n    1000\n  )\n\n  private set(key: string, value: string): void {\n    localStorage.setItem(key, value)\n  }\n  private get(key: string): string | null {\n    return localStorage.getItem(key)\n  }\n  private remove(key: string): void {\n    localStorage.removeItem(key)\n  }\n}\n","import { action, observable } from 'mobx'\nimport { DisplayState } from '../DisplayState'\nimport { MockupHidden, MockupState } from '../../model/display/MockupState'\n\nexport class DefaultDisplayState implements DisplayState {\n  @observable mockup: MockupState = MockupHidden\n  @observable resizing: boolean = false\n\n  @action\n  async setMockupState(state: MockupState): Promise<void> {\n    this.mockup = state\n  }\n\n  @action\n  async closeMockup(): Promise<void> {\n    this.mockup = MockupHidden\n  }\n\n  @action\n  setResizing(b: boolean): void {\n    this.resizing = b\n  }\n}\n","// モックアップの表示をコントロールするための情報\nexport type MockupState = number\n\n// 非表示\nexport const MockupHidden: MockupState = 1\n\n// 将棋エンジンとの接続を制御したりする画面\nexport const MockupEngineControl: MockupState = 2\n\n// shogi-board-server の URL が設定されていないとき\n// 将棋エンジンに接続するボタンが押されたときに出す画面\nexport const MockupServerSetting: MockupState = 3\n\n// 設定画面\nexport const MockupSetting: MockupState = 4\n","import { Gyoku0, Gyoku1, Piece } from '../../model/shogi/Piece'\n\n/**\n * 持ち駒を1つ増やす\n * @param cap number[] 持ち駒を表す配列。詳細は Position.ts\n * @param p Piece 増やしたい駒\n */\nexport function increaseCaptures(cap: number[], p: Piece): number[] {\n  return handle(cap, Math.abs(p), i => i + 1)\n}\n\n/**\n * 持ち駒を1つ減らす\n * @param cap number[] 持ち駒を表す配列。詳細は Position.ts\n * @param p Piece 減らしたい駒\n */\nexport function decreaseCaptures(cap: number[], p: Piece): number[] {\n  return handle(cap, Math.abs(p), i => i - 1)\n}\n\nfunction handle(cap: number[], p: Piece, f: (i: number) => number): number[] {\n  if (p === Gyoku0 || p === Gyoku1 || p > 10)\n    throw new Error('Piece ID of Captures must not be Gyoku or over 10.')\n\n  return cap.map((count, index) => {\n    // 駒IDが一致しなければそのまま\n    // p は Math.abs() を通っている\n    if (index !== p - 1) return count\n\n    const v = f(count)\n    if (v < 0)\n      throw new Error(\n        'Invalid function call. Captures must not contain negative value.'\n      )\n\n    return v\n  })\n}\n","export type Piece = number\n\nexport const Empty: Piece = 0\n\nexport const Fu0: Piece = 1\nexport const Kyou0: Piece = 2\nexport const Kei0: Piece = 3\nexport const Gin0: Piece = 4\nexport const Kin0: Piece = 5\nexport const Kaku0: Piece = 6\nexport const Hisha0: Piece = 7\nexport const Gyoku0: Piece = 8\nexport const To0: Piece = 11\nexport const NariKyou0: Piece = 12\nexport const NariKei0: Piece = 13\nexport const NariGin0: Piece = 14\nexport const Uma0: Piece = 16\nexport const Ryu0: Piece = 17\n\nexport const Fu1: Piece = -Fu0\nexport const Kyou1: Piece = -Kyou0\nexport const Kei1: Piece = -Kei0\nexport const Gin1: Piece = -Gin0\nexport const Kin1: Piece = -Kin0\nexport const Kaku1: Piece = -Kaku0\nexport const Hisha1: Piece = -Hisha0\nexport const Gyoku1: Piece = -Gyoku0\nexport const To1: Piece = -To0\nexport const NariKyou1: Piece = -NariKyou0\nexport const NariKei1: Piece = -NariKei0\nexport const NariGin1: Piece = -NariGin0\nexport const Uma1: Piece = -Uma0\nexport const Ryu1: Piece = -Ryu0\n","import {\n  Piece,\n  Empty,\n  Hisha0,\n  Kin0,\n  Fu0,\n  Fu1,\n  Kyou0,\n  Kyou1,\n  Kei0,\n  Kei1,\n} from '../../model/shogi/Piece'\n\n/**\n * 駒を成る\n * canPromote を通っている前提\n * @param p Piece 成る前の駒\n */\nexport function promote(p: Piece): Piece {\n  if (p > 0) return p + 10\n  return p - 10\n}\n\n/**\n * 駒を成る前の駒にする\n * @param p Piece 成駒\n */\nexport function demote(p: Piece): Piece {\n  if (Math.abs(p) < 10) return p\n\n  if (p < 0) return p + 10\n  return p - 10\n}\n\nexport interface CanPromoteProps {\n  // 移動前の行\n  sourceRow: number\n\n  // 移動後の行\n  destRow: number\n\n  // 移動する駒\n  piece: Piece\n}\n\n/**\n * 成・不成の選択ができるかどうか\n * 選択可能: true\n * 選択不可: false\n * @param props CanPromoteProps\n * @returns boolean\n *          成れる駒 && sourceRow か destRow が敵陣なら true\n *          成れない駒(金とか、既に成駒の場合)なら false\n */\nexport function canPromote(props: CanPromoteProps): boolean {\n  // 持ち駒\n  if (props.sourceRow === -1) return false\n\n  const isPromotable: boolean =\n    props.piece !== Empty &&\n    Math.abs(props.piece) !== Kin0 &&\n    Math.abs(props.piece) <= Hisha0\n\n  const rows: number[] = props.piece > 0 ? [0, 1, 2] : [6, 7, 8]\n  const isInEnemyArea: boolean =\n    rows.includes(props.sourceRow) || rows.includes(props.destRow)\n\n  return isPromotable && isInEnemyArea\n}\n\n/**\n * 移動後に、必ず成る必要があるか\n * 歩・香・桂が不成の場合に次に動けないとき true\n * @param p Piece 動かす駒\n * @param row 移動後の行\n * @returns boolean\n *          成必要がある場合 true\n */\nexport function mustPromote(p: Piece, row: number): boolean {\n  return (\n    ((p === Fu0 || p === Kyou0) && row === 0) ||\n    ((p === Fu1 || p === Kyou1) && row === 8) ||\n    (p === Kei0 && (row === 0 || row === 1)) ||\n    (p === Kei1 && (row === 8 || row === 7))\n  )\n}\n","import { MoveProps } from '../../model/events/MoveProps'\nimport { Empty, Piece } from '../../model/shogi/Piece'\nimport { Position } from '../../model/shogi/Position'\nimport { Gote, Sente, Turn } from '../../model/shogi/Turn'\nimport { decreaseCaptures, increaseCaptures } from './captures'\nimport { demote } from './piece'\n\nexport function move(p: MoveProps): Position {\n  // 持ち駒を更新する\n  type CaptureHandler = (cap: number[], turn: Turn) => number[]\n  const handleCaptures: CaptureHandler = (cap: number[], turn: Turn) => {\n    // 手番ではない場合、何もしない\n    if (p.pos.turn !== turn) return cap.slice()\n\n    // 移動先が相手の駒なら持ち駒を増やす\n    const d: Piece = p.pos.pos[p.dest.row][p.dest.column]\n    if (d * turn < 0) return increaseCaptures(cap, demote(d))\n\n    // 移動元が持ち駒なら減らす\n    if (p.source.row === -1 && p.source.column === -1)\n      return decreaseCaptures(cap, p.piece)\n\n    return cap.slice()\n  }\n\n  const updatedCap0: number[] = handleCaptures(p.pos.cap0, Sente)\n  const updatedCap1: number[] = handleCaptures(p.pos.cap1, Gote)\n\n  return {\n    pos: moveOnBoard(p),\n    cap0: updatedCap0,\n    cap1: updatedCap1,\n    turn: -p.pos.turn as Turn,\n    moveCount: p.pos.moveCount + 1,\n  }\n}\n\nexport function moveBoardOnly(p: MoveProps): Position {\n  return {\n    pos: moveOnBoard(p),\n    cap0: p.pos.cap0.slice(),\n    cap1: p.pos.cap1.slice(),\n    turn: -p.pos.turn as Turn,\n    moveCount: p.pos.moveCount + 1,\n  }\n}\n\nfunction moveOnBoard(p: MoveProps): number[][] {\n  return p.pos.pos.map((line, r) =>\n    line.map((piece, c) => {\n      // 移動前の位置なら空マスに\n      if (p.source.row === r && p.source.column === c) return Empty\n\n      // 移動先の位置なら更新\n      if (p.dest.row === r && p.dest.column === c) return p.piece\n\n      return piece\n    })\n  )\n}\n","// 手番\n//  1: 先手\n// -1: 後手\nexport type Turn = 1 | -1\n\nexport const Sente: Turn = 1\nexport const Gote: Turn = -1\n","import { action, observable } from 'mobx'\n\ninterface Option<T> {\n  readonly name: string\n  setValue(value: T): void\n}\n\nexport class Button implements Option<any> {\n  readonly name: string\n  constructor(name: string) {\n    this.name = name\n  }\n\n  setValue(_: any): void {}\n}\n\nexport class Check implements Option<boolean> {\n  @observable value: boolean\n  readonly name: string\n  readonly default: boolean\n  constructor(name: string, value: boolean, initial: boolean) {\n    this.name = name\n    this.value = value\n    this.default = initial\n  }\n\n  @action setValue(value: boolean): void {\n    this.value = value\n  }\n}\n\nexport class Range implements Option<string> {\n  @observable value: number\n  @observable inputValue: string\n  readonly name: string\n  readonly default: number\n  readonly min: number\n  readonly max: number\n  constructor(\n    name: string,\n    value: number,\n    initial: number,\n    min: number,\n    max: number\n  ) {\n    this.name = name\n    this.value = value\n    this.inputValue = value.toString()\n    this.default = initial\n    this.min = min\n    this.max = max\n  }\n\n  @action setValue(value: string): void {\n    this.inputValue = value\n    const n: number = Number(this.inputValue)\n    if (Number.isNaN(n) || n < this.min || n > this.max) return\n    this.value = n\n  }\n}\n\nexport class Select implements Option<string> {\n  @observable value: string\n  readonly name: string\n  readonly default: string\n  readonly vars: string[]\n  constructor(name: string, value: string, initial: string, vars: string[]) {\n    this.name = name\n    this.value = value\n    this.default = initial\n    this.vars = vars\n  }\n\n  @action setValue(value: string) {\n    this.value = value\n  }\n}\n\nexport class Text implements Option<string> {\n  @observable value: string\n  readonly name: string\n  readonly default: string\n\n  constructor(name: string, value: string, initial: string) {\n    this.name = name\n    this.value = value\n    this.default = initial\n  }\n\n  @action setValue(value: string) {\n    this.value = value\n  }\n}\n\nexport interface Options {\n  buttons: Map<string, Button>\n  checks: Map<string, Check>\n  ranges: Map<string, Range>\n  selects: Map<string, Select>\n  texts: Map<string, Text>\n}\n","import axios from 'axios'\nimport debounce from 'lodash.debounce'\nimport shortid from 'shortid'\nimport { move } from '../handler/game/position'\nimport { Info } from '../model/engine/Info'\nimport {\n  Button,\n  Check,\n  Options,\n  Range,\n  Select,\n  Text,\n} from '../model/engine/Optoin'\nimport { MoveProps } from '../model/events/MoveProps'\nimport { Move } from '../model/kifu/Move'\nimport { ResponseInfo } from '../model/response/ResponseInfo'\nimport { Empty } from '../model/shogi/Piece'\nimport { Position } from '../model/shogi/Position'\n\nconst DEBOUNCE_MILLIS = 1000\n\nexport class ShogiBoardClient {\n  private _engineName?: string\n  private _serverURL?: string\n\n  private readonly engineNameKey = 'key'\n\n  constructor(engineName?: string, serverURL?: string) {\n    this._engineName = engineName\n    this._serverURL = serverURL\n  }\n\n  set engineName(name: string) {\n    this._engineName = name\n  }\n\n  get engineName(): string {\n    if (!this._engineName) throw new Error('engineName is not defined.')\n    return this._engineName\n  }\n\n  set serverURL(url: string) {\n    this._serverURL = url\n  }\n\n  get serverURL(): string {\n    if (!this._serverURL) throw new Error('serverURL is not defined. serverURL')\n    return this._serverURL\n  }\n\n  async init(): Promise<string[]> {\n    const url = await this.buildUrl('init', false)\n    const res = await axios.post(url)\n    return res.data\n  }\n\n  async connect(): Promise<void> {\n    return await this.post('connect')\n  }\n\n  async close(): Promise<void> {\n    return await this.post('close')\n  }\n\n  async start(): Promise<void> {\n    return await this.post('start')\n  }\n\n  async stop(): Promise<void> {\n    return await this.post('stop')\n  }\n\n  async getOptions(): Promise<Options> {\n    // res は Options と言いつつ、中身は Map じゃなくて object\n    // TODO: データの持ち方考える\n    const res: Options = await this.get('options/get')\n    const m: Options = {\n      buttons: new Map(),\n      checks: new Map(),\n      ranges: new Map(),\n      selects: new Map(),\n      texts: new Map(),\n    }\n    Object.values(res.buttons).forEach(b =>\n      m.buttons.set(b.name, new Button(b.name))\n    )\n    Object.values(res.checks).forEach(c =>\n      m.checks.set(c.name, new Check(c.name, c.value, c.default))\n    )\n    Object.values(res.ranges).forEach(r =>\n      m.ranges.set(r.name, new Range(r.name, r.value, r.default, r.min, r.max))\n    )\n    Object.values(res.selects).forEach(s =>\n      m.selects.set(s.name, new Select(s.name, s.value, s.default, s.vars))\n    )\n    Object.values(res.texts).forEach(t =>\n      m.texts.set(t.name, new Text(t.name, t.value, t.default))\n    )\n    return m\n  }\n\n  async updateButton(btn: Button): Promise<void> {\n    return await this.post('options/update/button', btn)\n  }\n\n  async updateCheck(chk: Check): Promise<void> {\n    return await this.post('options/update/check', chk)\n  }\n\n  updateRange = debounce(async (rng: Range): Promise<void> => {\n    return await this.post('options/update/range', rng)\n  }, DEBOUNCE_MILLIS)\n\n  async updateSelect(sel: Select): Promise<void> {\n    return await this.post('options/update/select', sel)\n  }\n\n  updateText = debounce(async (txt: Text): Promise<void> => {\n    return await this.post('options/update/text', txt)\n  }, DEBOUNCE_MILLIS)\n\n  async getResult(current: Move): Promise<Info[]> {\n    const resp: { number: ResponseInfo } = await this.get('result/get')\n    let p: Position = current.pos\n\n    // レスポンスのキーでソートされた ResponseInfo を取り出し、\n    // move メソッドで局面を動かしながら Info を生成していく\n    return Object.entries(resp)\n      .sort((a, b) => {\n        if (a[0] < b[0]) return -1\n        if (a[0] > b[0]) return 1\n        return 0\n      })\n      .map(([_, info]) => {\n        let i: number = 0\n        p = current.pos\n        const moves: MoveProps[] = []\n\n        try {\n          while (i < info.moves.length) {\n            const m = info.moves[i]\n            const source = { row: m.source!.row, column: m.source!.column }\n            const dest = { row: m.dest!.row, column: m.dest!.column }\n            const piece = m.pieceId || p.pos[source.row][source.column]\n            if (piece === Empty) break\n            const mp: MoveProps = {\n              pos: p,\n              source,\n              dest,\n              piece,\n              promote: m.isPromoted,\n            }\n            moves.push(mp)\n            p = move(mp)\n            i = (i + 1) | 0\n          }\n        } catch (e) {\n          // ズレは出るのでエラーは握りつぶす\n          // console.error(i, p, e)\n        }\n\n        const values = new Map()\n        Object.entries(info.values).forEach(([k, v]) => values.set(k, v))\n\n        return {\n          id: shortid.generate(),\n          values, // 一旦捨てる\n          score: info.score * current.pos.turn, // 後手番なら -1 をかける\n          moves,\n        }\n      })\n  }\n\n  async setPosition(p: Position): Promise<void> {\n    const pos: Position = {\n      pos: p.pos.map(r => r.slice().reverse()),\n      cap0: p.cap0,\n      cap1: p.cap1,\n      turn: p.turn,\n      moveCount: p.moveCount,\n    }\n    return await this.post('position/set', pos)\n  }\n\n  private async get<T>(path: string): Promise<T> {\n    const url = await this.buildUrl(path, true)\n    const res = await axios.get(url)\n    return res.data\n  }\n\n  private async post(path: string, body?: object): Promise<void> {\n    const url = await this.buildUrl(path, true)\n    await axios.post(url, body, {\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n\n  private async buildUrl(path: string, withName: boolean) {\n    const e = (s: string) => encodeURIComponent(s)\n    const query = withName ? `?${this.engineNameKey}=${e(this.engineName)}` : ''\n    return `${this.serverURL}/${path}${query}`\n  }\n\n  private e(s: any): string {\n    return encodeURIComponent(s)\n  }\n}\n","import { action, computed, observable } from 'mobx'\nimport { ShogiBoardClient } from '../../infrastructure/ShogiBoardClient'\nimport { EngineState } from '../EngineState'\nimport { Info } from '../../model/engine/Info'\nimport { Options } from '../../model/engine/Optoin'\nimport {\n  Connected,\n  Connecting,\n  NotConnected,\n  StandBy,\n  State,\n  Thinking,\n} from '../../model/engine/State'\nimport { Position } from '../../model/shogi/Position'\n\nexport class DefaultEngineState implements EngineState {\n  @observable names: string[] = []\n  @observable current: string | null = null\n  @observable options: Options | null = null\n  @observable state: State = NotConnected\n  @observable result: Info[] | null = null\n  @observable serverURL: string = ''\n\n  @computed get sbclient(): ShogiBoardClient {\n    return new ShogiBoardClient(this.current || '', this.serverURL)\n  }\n\n  @action async setNames(names: string[]): Promise<void> {\n    this.names = names\n  }\n\n  @action async setState(state: State): Promise<void> {\n    this.state = state\n  }\n\n  @action async connect(name: string): Promise<void> {\n    if (!this.names.includes(name))\n      throw new Error('Unknown engine name. name=' + name)\n\n    this.current = name\n    try {\n      this.setState(Connecting)\n      await this.sbclient.connect()\n      this.options = await this.sbclient.getOptions()\n      this.setState(Connected)\n    } catch (e) {\n      console.error('Failed to connect', e)\n      alert('接続に失敗しました') // TODO\n      await this.disconnect()\n    }\n  }\n\n  @action async disconnect(): Promise<void> {\n    try {\n      await this.sbclient.close()\n    } catch (e) {\n      console.error('接続解除に失敗しました', e)\n    } finally {\n      this.current = null\n      this.options = null\n      this.state = NotConnected\n    }\n  }\n\n  @action async startThinking(): Promise<void> {\n    if (!this.current)\n      throw new Error('[startThinking] current engine is not set')\n\n    await this.sbclient.start()\n    await this.setState(Thinking)\n  }\n\n  @action async stopThinking(): Promise<void> {\n    if (!this.current)\n      throw new Error('[stopThinking] current engine is not set')\n    if (this.state !== Thinking) return\n\n    await this.sbclient.stop()\n    await this.setState(StandBy)\n  }\n\n  @action async setResult(i: Info[]): Promise<void> {\n    this.result = i\n  }\n\n  async updatePosition(p: Position): Promise<void> {\n    await this.sbclient.setPosition(p)\n  }\n\n  @action async setServerURL(s: string): Promise<void> {\n    this.serverURL = s\n  }\n}\n","// 将棋エンジンの状態を表すID\nexport type State = 0 | 1 | 2 | 3 | 4\n\n// 接続前\nexport const NotConnected: State = 0\n\n// 接続中・ローディング中のComponentを表示するため\nexport const Connecting: State = 1\n\n// 接続済\nexport const Connected: State = 2\n\n// 将棋エンジン、待機中(思考中ではない)\nexport const StandBy: State = 3\n\n// 将棋エンジン思考中\nexport const Thinking: State = 4\n","import Branch from './Branch'\nimport { Move } from './Move'\n\nexport type KifuComponent = Move | Branch\n\n// TODO: もうちょい持ち方考える\n// 理想は\n// {\n//   head: Move,\n//   next: History,\n//   isCurrent: boolean\n// }\n// だが、JSON互換的に苦しい感じ\nexport default interface History {\n  moves: KifuComponent[]\n\n  // history のインデックス\n  // ブラウザで表示するときに現在局面がどこか探せるように\n  index: number\n}\n\nexport function isBranch(m: KifuComponent): m is Branch {\n  return 'branches' in m\n}\n","import Branch from '../../model/kifu/Branch'\nimport History, { isBranch, KifuComponent } from '../../model/kifu/History'\nimport Kifu from '../../model/kifu/Kifu'\n\n/**\n * 現在局面を更新した新しい棋譜を返す\n * @param k Kifu 更新したい棋譜\n * @param x number 現在局面にしたい手数\n * @param y number | undefined 分岐を切り替える場合のみ、分岐のインデックス\n */\nexport function changeIndex(k: Kifu, x: number, y?: number): Kifu {\n  return {\n    meta: k.meta,\n    history: changeHistory(k.history, x, y),\n  }\n}\n\n// TODO: Move にインデックスを入れたので、少しシンプルにできる\nfunction changeHistory(h: History, x: number, y?: number): History {\n  const lastIndex: number = h.moves.length - 1\n  const last: KifuComponent = h.moves[lastIndex]\n  const init: KifuComponent[] = h.moves.slice(0, lastIndex)\n\n  const xPassesIfBranch: number = x <= lastIndex ? 0 : x - lastIndex\n\n  const moves: KifuComponent[] = isBranch(last)\n    ? init.concat(changeBranch(last, xPassesIfBranch, y))\n    : h.moves.slice()\n\n  const index: number = x <= lastIndex ? x : lastIndex\n\n  return { moves, index }\n}\n\nfunction changeBranch(b: Branch, x: number, y?: number): Branch {\n  const index = x === 0 && y !== undefined ? y : b.index\n\n  if (x === 0)\n    return {\n      branches: b.branches.map(h => changeHistory(h, 0)),\n      index,\n    }\n\n  const branches = b.branches.map((h: History, i: number) =>\n    i === b.index ? changeHistory(h, x, y) : h\n  )\n\n  return { branches, index }\n}\n","import {\n  Fu0,\n  Gin0,\n  Gyoku0,\n  Hisha0,\n  Kaku0,\n  Kei0,\n  Kin0,\n  Kyou0,\n  NariGin0,\n  NariKei0,\n  NariKyou0,\n  Piece,\n  Ryu0,\n  To0,\n  Uma0,\n} from '../model/shogi/Piece'\n\nconst rows = ['一', '二', '三', '四', '五', '六', '七', '八', '九']\nconst columns = ['１', '２', '３', '４', '５', '６', '７', '８', '９']\n\nexport function rowString(r: number): string {\n  return rows[r]\n}\n\nexport function columnString(c: number): string {\n  return columns[c]\n}\n\nexport function pieceString(piece: Piece): string {\n  const p = Math.abs(piece)\n\n  if (p === Fu0) return '歩'\n  if (p === Kyou0) return '香'\n  if (p === Kei0) return '桂'\n  if (p === Gin0) return '銀'\n  if (p === Kin0) return '金'\n  if (p === Kaku0) return '角'\n  if (p === Hisha0) return '飛'\n  if (p === Gyoku0) return '玉'\n  if (p === To0) return 'と'\n  if (p === NariKyou0) return '成香'\n  if (p === NariKei0) return '成桂'\n  if (p === NariGin0) return '成銀'\n  if (p === Uma0) return '馬'\n  if (p === Ryu0) return '龍'\n\n  throw new Error('Failed to ident piece name. received: ' + piece)\n}\n","import { Piece, Empty } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\n\nexport default function (\n  pos: Piece[][],\n  invalidRows?: number[],\n  invalidColumns?: number[]\n): Point[] {\n  const points: Point[] = []\n\n  for (let r = 0; r < 9; r++) {\n    if (invalidRows && invalidRows.includes(r)) continue\n\n    for (let c = 0; c < 9; c++) {\n      const columnIsInvalid = invalidColumns && invalidColumns.includes(c)\n      if (columnIsInvalid || pos[r][c] !== Empty) continue\n      points.push({ row: r, column: c })\n    }\n  }\n\n  return points\n}\n","import { Piece } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\n\nexport default function (pos: Piece[][], nexts: number[][], p: Piece): Point[] {\n  const points: Point[] = []\n\n  for (let i = 0; i < nexts.length; i++) {\n    const row = nexts[i][0]\n    const column = nexts[i][1]\n    if (\n      row >= 0 &&\n      row <= 8 &&\n      column >= 0 &&\n      column <= 8 &&\n      pos[row][column] * p <= 0\n    )\n      points.push({ row, column })\n  }\n\n  return points\n}\n","import Point from '../../../model/shogi/Point'\n\nexport function comp(a: Point, b: Point): number {\n  return a.row - b.row || a.column - b.column\n}\n\nexport function find(pts: Point[], p: Point): number {\n  let i = pts.length >> 1\n  let l = 0\n  let r = pts.length - 1\n\n  while (l <= r) {\n    if (pts[i].row === p.row && pts[i].column === p.column) return i\n    if (pts[i].row < p.row) l = i + 1\n    else if (pts[i].row > p.row) r = i - 1\n    else if (pts[i].column < p.column) l = i + 1\n    else r = i - 1\n    i = l + ((r - l) >> 1)\n  }\n\n  return -1\n}\n","import { Piece } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\n\nexport default function (\n  pos: Piece[][],\n  row: number,\n  column: number,\n  piece: Piece,\n  points: Point[],\n  rowDiff: number,\n  columnDiff: number\n): void {\n  while (0 <= row && row <= 8 && 0 <= column && column <= 8) {\n    const target: Piece = pos[row][column]\n    if (target * piece > 0) break\n    points.push({ row, column })\n    if (target * piece < 0) break\n    row += rowDiff\n    column += columnDiff\n  }\n}\n","import { Hisha0, Hisha1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport { comp } from '../utils/algorithm'\nimport getEmpties from '../utils/getEmpties'\nimport getWithDiff from '../utils/getWithDiff'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Hisha0 && p.piece !== Hisha1))\n    throw new Error('Called validation for hisha, but piece id was not hisha.')\n\n  if (p.row === -1 && p.column === -1) return getEmpties(pos.pos)\n\n  const diffList = [\n    [-1, 0],\n    [0, -1],\n    [0, 1],\n    [1, 0],\n  ]\n  const points: Point[] = []\n\n  for (let i = 0; i < diffList.length; i++) {\n    getWithDiff(\n      pos.pos,\n      p.row + diffList[i][0],\n      p.column + diffList[i][1],\n      p.piece,\n      points,\n      diffList[i][0],\n      diffList[i][1]\n    )\n  }\n\n  points.sort(comp)\n  return points\n}\n","import { Kaku0, Kaku1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport { comp } from '../utils/algorithm'\nimport getEmpties from '../utils/getEmpties'\nimport getWithDiff from '../utils/getWithDiff'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Kaku0 && p.piece !== Kaku1))\n    throw new Error('Called validation for kaku, but piece id was not kaku.')\n\n  if (p.row === -1 && p.column === -1) return getEmpties(pos.pos)\n\n  const diffList = [\n    [-1, -1],\n    [-1, 1],\n    [1, -1],\n    [1, 1],\n  ]\n  const points: Point[] = []\n\n  for (let i = 0; i < diffList.length; i++) {\n    getWithDiff(\n      pos.pos,\n      p.row + diffList[i][0],\n      p.column + diffList[i][1],\n      p.piece,\n      points,\n      diffList[i][0],\n      diffList[i][1]\n    )\n  }\n\n  points.sort(comp)\n  return points\n}\n","import {\n  Empty,\n  Fu0,\n  Fu1,\n  Gin0,\n  Gin1,\n  Gyoku0,\n  Gyoku1,\n  Hisha0,\n  Hisha1,\n  Kaku0,\n  Kaku1,\n  Kei0,\n  Kei1,\n  Kin0,\n  Kin1,\n  Kyou0,\n  Kyou1,\n  NariGin0,\n  NariGin1,\n  NariKei0,\n  NariKei1,\n  NariKyou0,\n  NariKyou1,\n  Ryu0,\n  Ryu1,\n  To0,\n  To1,\n  Uma0,\n  Uma1,\n} from '../../model/shogi/Piece'\nimport Point from '../../model/shogi/Point'\nimport { Position } from '../../model/shogi/Position'\nimport fu from './pieces/fu'\nimport gin from './pieces/gin'\nimport gyoku from './pieces/gyoku'\nimport hisha from './pieces/hisha'\nimport kaku from './pieces/kaku'\nimport kei from './pieces/kei'\nimport kin from './pieces/kin'\nimport kyou from './pieces/kyou'\nimport ryu from './pieces/ryu'\nimport uma from './pieces/uma'\n\n/**\n * 駒を動かせる場所を取得する\n * @param pos Position 駒の配置\n * @param point Point 動ける場所を取得したい駒の位置\n */\nexport function getTargets(pos: Position, point: Point): Point[] {\n  const piece = point.piece\n\n  if (piece === Empty)\n    throw new Error('Cannot get targets to move for empty cell.')\n  if (piece === Fu0 || piece === Fu1) return fu(pos, point)\n  if (piece === Kyou0 || piece === Kyou1) return kyou(pos, point)\n  if (piece === Kei0 || piece === Kei1) return kei(pos, point)\n  if (piece === Gin0 || piece === Gin1) return gin(pos, point)\n  if (\n    piece === Kin0 ||\n    piece === Kin1 ||\n    piece === To0 ||\n    piece === To1 ||\n    piece === NariKyou0 ||\n    piece === NariKyou1 ||\n    piece === NariKei0 ||\n    piece === NariKei1 ||\n    piece === NariGin0 ||\n    piece === NariGin1\n  )\n    return kin(pos, point)\n  if (piece === Kaku0 || piece === Kaku1) return kaku(pos, point)\n  if (piece === Hisha0 || piece === Hisha1) return hisha(pos, point)\n  if (piece === Gyoku0 || piece === Gyoku1) return gyoku(pos, point)\n  if (piece === Uma0 || piece === Uma1) return uma(pos, point)\n  if (piece === Ryu0 || piece === Ryu1) return ryu(pos, point)\n\n  throw new Error('Could not get targets to move. Got invalid piece ID')\n}\n","import { Fu0, Fu1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport getEmpties from '../utils/getEmpties'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Fu0 && p.piece !== Fu1))\n    throw new Error('Called validation for fu, but piece id was not fu.')\n\n  // 二歩チェックのため、すでに歩がある列を入れておく\n  const columnsOfContainingFu: number[] = []\n  for (let col = 0; col < 9; col++) {\n    for (let row = 0; row < 9; row++) {\n      if (pos.pos[row][col] === p.piece) {\n        columnsOfContainingFu.push(col)\n        break\n      }\n    }\n  }\n\n  if (p.row === -1 && p.column === -1) {\n    const invalidRow: number = p.piece > 0 ? 0 : 8\n    return getEmpties(pos.pos, [invalidRow], columnsOfContainingFu)\n  }\n\n  const nextRow: number = p.piece > 0 ? p.row - 1 : p.row + 1\n\n  // 盤外か味方の駒ならなし\n  if (nextRow < 0 || nextRow > 8 || pos.pos[nextRow][p.column] * p.piece > 0)\n    return []\n\n  // 空マスか、相手の駒ならOK\n  return [{ row: nextRow, column: p.column }]\n}\n","import { Kyou0, Kyou1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport getEmpties from '../utils/getEmpties'\nimport getWithDiff from '../utils/getWithDiff'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Kyou0 && p.piece !== Kyou1))\n    throw new Error('Called validation for kyou, but piece id was not kyou.')\n\n  if (p.row === -1 && p.column === -1) {\n    const invalidRow: number = p.piece > 0 ? 0 : 8\n    return getEmpties(pos.pos, [invalidRow])\n  }\n\n  const diff = p.piece > 0 ? -1 : 1\n  const points: Point[] = []\n  getWithDiff(pos.pos, p.row + diff, p.column, p.piece, points, diff, 0)\n  if (p.piece > 0) points.reverse()\n  return points\n}\n","import { Kei0, Kei1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport getEmpties from '../utils/getEmpties'\nimport getFromNexts from '../utils/getFromNexts'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Kei0 && p.piece !== Kei1))\n    throw new Error('Called validation for kei, but piece id was not kei.')\n\n  if (p.row === -1 && p.column === -1) {\n    const invalidRow1: number = p.piece > 0 ? 0 : 8\n    const invalidRow2: number = p.piece > 0 ? invalidRow1 + 1 : invalidRow1 - 1\n    return getEmpties(pos.pos, [invalidRow1, invalidRow2])\n  }\n\n  const nextRow: number = p.piece > 0 ? p.row - 2 : p.row + 2\n  if (nextRow < 0 || nextRow > 8) return []\n  const nexts: number[][] = [\n    [nextRow, p.column - 1],\n    [nextRow, p.column + 1],\n  ]\n  return getFromNexts(pos.pos, nexts, p.piece)\n}\n","import { Gin0, Gin1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport getEmpties from '../utils/getEmpties'\nimport getFromNexts from '../utils/getFromNexts'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Gin0 && p.piece !== Gin1))\n    throw new Error('Called validation for gin, but piece id was not gin.')\n\n  if (p.row === -1 && p.column === -1) return getEmpties(pos.pos)\n\n  const nexts: number[][] =\n    p.piece > 0\n      ? [\n          [p.row - 1, p.column - 1],\n          [p.row - 1, p.column],\n          [p.row - 1, p.column + 1],\n          [p.row + 1, p.column - 1],\n          [p.row + 1, p.column + 1],\n        ]\n      : [\n          [p.row - 1, p.column - 1],\n          [p.row - 1, p.column + 1],\n          [p.row + 1, p.column - 1],\n          [p.row + 1, p.column],\n          [p.row + 1, p.column + 1],\n        ]\n\n  return getFromNexts(pos.pos, nexts, p.piece)\n}\n","import {\n  Kin0,\n  Kin1,\n  NariGin0,\n  NariGin1,\n  NariKei0,\n  NariKei1,\n  NariKyou0,\n  NariKyou1,\n  To0,\n  To1,\n} from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport getEmpties from '../utils/getEmpties'\nimport getFromNexts from '../utils/getFromNexts'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (\n    !p.piece ||\n    (p.piece !== Kin0 &&\n      p.piece !== Kin1 &&\n      p.piece !== To0 &&\n      p.piece !== To1 &&\n      p.piece !== NariKyou0 &&\n      p.piece !== NariKyou1 &&\n      p.piece !== NariKei0 &&\n      p.piece !== NariKei1 &&\n      p.piece !== NariGin0 &&\n      p.piece !== NariGin1)\n  )\n    throw new Error(\n      'Called validation for kin(or promoted piece moves as same as kin), but piece id was not as expected.'\n    )\n\n  if (p.row === -1 && p.column === -1) return getEmpties(pos.pos)\n\n  const nexts: number[][] =\n    p.piece > 0\n      ? [\n          [p.row - 1, p.column - 1],\n          [p.row - 1, p.column],\n          [p.row - 1, p.column + 1],\n          [p.row, p.column - 1],\n          [p.row, p.column + 1],\n          [p.row + 1, p.column],\n        ]\n      : [\n          [p.row - 1, p.column],\n          [p.row, p.column - 1],\n          [p.row, p.column + 1],\n          [p.row + 1, p.column - 1],\n          [p.row + 1, p.column],\n          [p.row + 1, p.column + 1],\n        ]\n\n  return getFromNexts(pos.pos, nexts, p.piece)\n}\n","import { Gyoku0, Gyoku1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport getFromNexts from '../utils/getFromNexts'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Gyoku0 && p.piece !== Gyoku1))\n    throw new Error('Called validation for gyoku, but piece id was not gyoku.')\n\n  if (p.row === -1 && p.column === -1)\n    throw new Error('Gyoku must not be captured')\n\n  const nexts: number[][] = [\n    [p.row - 1, p.column - 1],\n    [p.row - 1, p.column],\n    [p.row - 1, p.column + 1],\n    [p.row, p.column - 1],\n    [p.row, p.column + 1],\n    [p.row + 1, p.column - 1],\n    [p.row + 1, p.column],\n    [p.row + 1, p.column + 1],\n  ]\n\n  return getFromNexts(pos.pos, nexts, p.piece)\n}\n","import { Uma0, Uma1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport { demote } from '../../../handler/game/piece'\nimport { comp } from '../utils/algorithm'\nimport getFromNexts from '../utils/getFromNexts'\nimport kaku from './kaku'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Uma0 && p.piece !== Uma1))\n    throw new Error('Called validation for uma, but piece id was not uma.')\n\n  if (p.row === -1 || p.column === -1)\n    throw new Error('Uma must not be captured')\n\n  const nexts = [\n    [p.row - 1, p.column],\n    [p.row, p.column - 1],\n    [p.row, p.column + 1],\n    [p.row + 1, p.column],\n  ]\n\n  const kakuPoint = { row: p.row, column: p.column, piece: demote(p.piece) }\n  const kakuTargets = kaku(pos, kakuPoint)\n  const targets = getFromNexts(pos.pos, nexts, p.piece).concat(kakuTargets)\n  targets.sort(comp)\n  return targets\n}\n","import { Ryu0, Ryu1 } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport { demote } from '../../../handler/game/piece'\nimport { comp } from '../utils/algorithm'\nimport getFromNexts from '../utils/getFromNexts'\nimport hisha from './hisha'\n\nexport default function (pos: Position, p: Point): Point[] {\n  if (!p.piece || (p.piece !== Ryu0 && p.piece !== Ryu1))\n    throw new Error('Called validation for ryu, but piece id was not ryu.')\n\n  if (p.row === -1 || p.column === -1)\n    throw new Error('Ryu must not be captured')\n\n  const nexts = [\n    [p.row - 1, p.column - 1],\n    [p.row - 1, p.column + 1],\n    [p.row + 1, p.column - 1],\n    [p.row + 1, p.column + 1],\n  ]\n\n  const hishaPoint = { row: p.row, column: p.column, piece: demote(p.piece) }\n  const hishaTargets = hisha(pos, hishaPoint)\n  const targets = getFromNexts(pos.pos, nexts, p.piece).concat(hishaTargets)\n  targets.sort(comp)\n  return targets\n}\n","import { MoveProps } from '../../model/events/MoveProps'\nimport {\n  Fu0,\n  Fu1,\n  Gyoku0,\n  Gyoku1,\n  Hisha0,\n  Hisha1,\n  Kaku0,\n  Kaku1,\n  Kei0,\n  Kei1,\n  Kyou0,\n  Kyou1,\n  Ryu0,\n  Ryu1,\n  Uma0,\n  Uma1,\n} from '../../model/shogi/Piece'\nimport Point from '../../model/shogi/Point'\nimport { Position } from '../../model/shogi/Position'\nimport { Turn } from '../../model/shogi/Turn'\nimport { canPromote, demote } from '../game/piece'\nimport { columnString, pieceString, rowString } from '../../lib/strings'\nimport { getTargets } from '../../lib/validatior/getTargets'\n\n/*\n優先順位イメージ\n\n上|引\n左|右\n寄\n直\n(左|右)寄\n(左|右)(上|引)\n*/\n\n/**\n * 棋譜の文字列を生成する\n * 生成のルールについては以下を参照\n * https://www.shogi.or.jp/faq/kihuhyouki.html\n *\n * @param p MoveProps\n */\nexport function genKifuString(props: MoveProps): string {\n  const { source, dest, prevDest, piece, promote, pos } = props\n  const { row: srow, column: scol } = source\n  const { row: drow, column: dcol } = dest\n\n  const pc: string = pieceString(promote ? demote(piece) : piece)\n\n  const dr: string = rowString(drow)\n  const dc: string = columnString(dcol)\n  let base: string\n\n  // 同~ のように表記するか\n  const isSame: boolean = prevDest?.row === drow && prevDest?.column === dcol\n  if (isSame) base = `同${pc}`\n  else base = `${dc}${dr}${pc}`\n\n  // 味方の同じ種類の駒が他にあれば取得し、dest に移動できるものをリストアップする\n  const sourcePoint = { row: srow, column: scol, piece }\n  const targettings: Point[] = findSamePieces(sourcePoint, pos).filter(p =>\n    getTargets(pos, p).some(\n      ({ row, column }) => row === drow && column === dcol\n    )\n  )\n\n  const isMulti: boolean = targettings.length > 0\n\n  // 持ち駒から打つ場合\n  // 他に dest に移動できる駒が存在すれば '打' をつける\n  if (srow === -1) {\n    if (isMulti) return `${base}打`\n    return base\n  }\n\n  if (\n    piece === Kei0 ||\n    piece === Kei1 ||\n    piece === Hisha0 ||\n    piece === Hisha1 ||\n    piece === Kaku0 ||\n    piece === Kaku1 ||\n    piece === Ryu0 ||\n    piece === Ryu1 ||\n    piece === Uma0 ||\n    piece === Uma1\n  )\n    base += additionalForTwo(props, targettings[0])\n  else if (\n    piece !== Gyoku0 &&\n    piece !== Gyoku1 &&\n    piece !== Fu0 &&\n    piece !== Fu1 &&\n    piece !== Kyou0 &&\n    piece !== Kyou1\n  )\n    base += additional(props, targettings)\n\n  // true → 成\n  // false → 不成\n  // undefined → 無印\n  // MoveProps を参照。\n  if (promote) base += '成'\n  // 成れる駒なら 不成 とする\n  else if (\n    promote === false && // undefined を弾いている\n    canPromote({ sourceRow: srow, destRow: drow, piece: piece })\n  )\n    base += '不成'\n\n  return base\n}\n\nfunction findSamePieces(point: Point, position: Position): Point[] {\n  const { row, column, piece } = point\n  const points: Point[] = []\n\n  const { turn, pos } = position\n  for (let r = 0; r <= 8; r++) {\n    for (let c = 0; c <= 8; c++) {\n      if (r === row && c === column) continue // 全く同じ駒は無視\n\n      const p = pos[r][c]\n      if (turn * p > 0 && p === piece) points.push({ row: r, column: c, piece })\n    }\n  }\n\n  return points\n}\n\nfunction additionalForTwo(\n  { source, dest, pos: { turn } }: MoveProps,\n  another?: Point\n): string {\n  if (!another) return ''\n  const { row: srow, column: scol } = source\n  const { row: drow } = dest\n  const { row: arow, column: acol } = another\n\n  if (srow === drow && arow !== drow) return '寄'\n  if (\n    (srow === drow && arow === drow) ||\n    (isAbove(srow, drow, turn) && isAbove(arow, drow, turn)) ||\n    (isBelow(srow, drow, turn) && isBelow(arow, drow, turn))\n  ) {\n    if (isLeft(scol, acol, turn)) return '左'\n    return '右'\n  }\n  if (isAbove(srow, arow, turn)) return '引'\n  return '上'\n}\n\nfunction additional(\n  { source, dest, pos: { turn } }: MoveProps,\n  targettings: Point[]\n): string {\n  if (targettings.length === 0) return ''\n\n  const { row: srow, column: scol } = source\n  const { row: drow, column: dcol } = dest\n\n  const moving = {\n    sameRow: srow === drow,\n    sameCol: scol === dcol,\n    below: isBelow(srow, drow, turn),\n    above: isAbove(srow, drow, turn),\n    left: isLeft(scol, dcol, turn),\n    right: isRight(scol, dcol, turn),\n  }\n\n  const another = {\n    sameRow: false,\n    below: false,\n    above: false,\n    left: false,\n    right: false,\n  }\n\n  for (let { row, column: col } of targettings) {\n    if (row === drow) another.sameRow = true\n    if (isBelow(row, drow, turn)) another.below = true\n    if (isAbove(row, drow, turn)) another.above = true\n    if (isLeft(col, dcol, turn)) another.left = true\n    if (isRight(col, dcol, turn)) another.right = true\n  }\n\n  if (moving.below && !another.below) return '上'\n  if (moving.below && moving.sameCol) return '直'\n  if (moving.above && !another.above) return '引'\n  if (moving.sameRow && !another.sameRow) return '寄'\n  if (moving.left && !another.left) return '左'\n  if (moving.right && !another.right) return '右'\n\n  if (moving.sameRow && moving.left) return '左寄'\n  if (moving.sameRow) return '右寄'\n\n  if (moving.below && moving.left) return '左上'\n  if (moving.below) return '右上'\n\n  if (moving.above && moving.left) return '左引'\n  return '右引'\n  // '引直' はありえない\n}\n\nfunction isBelow(srow: number, drow: number, turn: Turn): boolean {\n  return (srow - drow) * turn > 0\n}\nfunction isAbove(srow: number, drow: number, turn: Turn): boolean {\n  return (srow - drow) * turn < 0\n}\n\nfunction isLeft(scol: number, dcol: number, turn: Turn): boolean {\n  return (scol - dcol) * turn > 0\n}\nfunction isRight(scol: number, dcol: number, turn: Turn): boolean {\n  return (scol - dcol) * turn < 0\n}\n","import Branch from '../../model/kifu/Branch'\nimport History, { isBranch, KifuComponent } from '../../model/kifu/History'\nimport Kifu from '../../model/kifu/Kifu'\nimport { Move } from '../../model/kifu/Move'\n\n/**\n * 棋譜に新しいMoveを追加する\n * @param old Kifu\n * @param m Move 追加する一手\n */\nexport default function (old: Kifu, m: Move): Kifu {\n  return {\n    meta: old.meta,\n    history: pushToHistory(old.history, m),\n  }\n}\n\nfunction pushToHistory(h: History, m: Move): History {\n  const lastIsCurrent: boolean = h.index === h.moves.length - 1\n  const last: KifuComponent = h.moves[h.index]\n\n  if (lastIsCurrent && isBranch(last))\n    return {\n      moves: h.moves\n        .slice(0, h.moves.length - 1)\n        .concat(pushToBranch(last, m, true)),\n      index: h.index,\n    }\n\n  const nextIndex: number = h.index + 1\n\n  if (lastIsCurrent)\n    return {\n      moves: h.moves.concat(m),\n      index: nextIndex,\n    }\n\n  const next: KifuComponent = h.moves[nextIndex]\n  const init: KifuComponent[] = h.moves.slice(0, nextIndex)\n\n  if (isBranch(next))\n    return {\n      moves: init.concat(pushToBranch(next, m, false)),\n      index: nextIndex,\n    }\n\n  // 追加しようとしてる Move が次と一緒ならインデックスだけ更新\n  if (moveEquals(m, next))\n    return {\n      moves: h.moves.slice(),\n      index: nextIndex,\n    }\n\n  const tail: KifuComponent[] = h.moves.slice(nextIndex, h.moves.length)\n  return {\n    moves: init.concat(createBranch(tail, m)),\n    index: nextIndex,\n  }\n}\n\nfunction pushToBranch(b: Branch, m: Move, recursive: boolean): Branch {\n  // 分岐の先頭は現在表示局面ではないので、再帰的に更新する\n  if (recursive)\n    return {\n      branches: b.branches.map((h: History, i: number) => {\n        if (i === b.index) return pushToHistory(h, m)\n        return h\n      }),\n      index: b.index,\n    }\n\n  const indexOfNewMove: number = b.branches.findIndex(h =>\n    moveEquals(h.moves[0] as Move, m)\n  )\n\n  // 追加しようとしてる Move がすでに分岐の先頭にある\n  if (indexOfNewMove !== -1)\n    return {\n      branches: b.branches.slice(),\n      index: indexOfNewMove,\n    }\n\n  return {\n    branches: b.branches.concat(toHistory([m])),\n    index: b.branches.length,\n  }\n}\n\nfunction createBranch(tail: KifuComponent[], m: Move): Branch {\n  return {\n    branches: [toHistory(tail), toHistory([m])],\n    index: 1,\n  }\n}\n\nfunction toHistory(c: KifuComponent[]): History {\n  return { moves: c, index: 0 }\n}\n\nfunction moveEquals(a: Move, b: Move): boolean {\n  return (\n    a.index === b.index &&\n    a.source.row === b.source.row &&\n    a.source.column === b.source.column &&\n    a.dest.row === b.dest.row &&\n    a.dest.column === b.dest.column &&\n    a.piece === b.piece &&\n    a.promote === b.promote\n  )\n}\n","import { Gyoku0, Piece } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Turn } from '../../../model/shogi/Turn'\n\n/**\n * 玉の位置を探す\n * @param pos number[][] 盤上の配置\n * @param turn Turn どっちの玉を探すか。先手玉を探したいときは Sente を渡す\n * @returns 見つかった場合 Point\n *          見つからなかった場合 undefined\n */\nexport default function (pos: number[][], turn: Turn): Point | undefined {\n  for (let r = 0; r < pos.length; r++) {\n    for (let c = 0; c < pos.length; c++) {\n      const piece: Piece = pos[r][c]\n      const isGyoku: boolean = Math.abs(piece) === Gyoku0\n      const isOwnersTurn: boolean = piece * turn > 0\n      if (isGyoku && isOwnersTurn) return { row: r, column: c, piece }\n    }\n  }\n}\n","import { Gyoku0, Piece } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport { Turn } from '../../../model/shogi/Turn'\nimport { moveBoardOnly } from '../../../handler/game/position'\nimport { getTargets } from '../getTargets'\nimport { find } from './algorithm'\n\n/**\n * points が attacker の駒の効きに入っているか\n * 王手放置・打ち歩詰めチェックに使用する\n * 入っている: true\n * 入っていない: false\n *\n * 例. 初期局面で先手の59玉に、後手の駒の効きがあるかを調べるとき\n * pos は初期局面\n * point は、{ row: 8, column: 4 }\n * attacker は Gote(-1)\n * を渡し、false が返る\n *\n * @param pos Position 配置\n * @param point Point 調べたい位置\n * @param attacker Turn 攻め手番\n * @param ignoreCheckLeaving boolean | undefined 王手放置チェックを無視するか\n *                           無視する(チェックしない): true\n *                           無視しない(チェックする): false | undefined\n *                           基本的に外から呼ぶ時は undefined で\n */\nexport default function isPointed(\n  pos: Position,\n  point: Point,\n  attacker: Turn,\n  ignoreCheckLeaving?: boolean\n): boolean {\n  for (let row = 0; row < pos.pos.length; row++) {\n    for (let column = 0; column < pos.pos.length; column++) {\n      const piece: Piece = pos.pos[row][column]\n      // 受け側の駒か、空マスならスキップ\n      if (piece * attacker <= 0) continue\n\n      // 攻め側の駒の targets に point が含まれていなかったらスキップ\n      const targets: Point[] = getTargets(pos, { row, column, piece })\n      const foundIndex: number = find(targets, point)\n      if (foundIndex === -1) continue\n\n      // 王手放置チェックをしないとき、\n      // 攻め側の駒が玉じゃないとき、\n      // 受け側の駒が玉の時は\n      // 次に動けるので true\n      if (\n        ignoreCheckLeaving ||\n        Math.abs(piece) !== Gyoku0 ||\n        (point.piece && Math.abs(point.piece) === Gyoku0)\n      )\n        return true\n\n      // 攻め側の駒が玉なので動かした結果、攻め側の玉が王手放置にならないか調べる\n      const moved = moveBoardOnly({\n        pos,\n        source: { row, column },\n        dest: { row: point.row, column: point.column },\n        piece,\n      })\n      if (isPointed(moved, point, -attacker as Turn, true)) continue\n      return true\n    }\n  }\n\n  return false\n}\n","import { action, computed, observable } from 'mobx'\nimport { canPromote, mustPromote, promote } from '../../handler/game/piece'\nimport { move } from '../../handler/game/position'\nimport { changeIndex } from '../../handler/kifu/changeIndex'\nimport { genKifuString } from '../../handler/kifu/genKifuString'\nimport getCurrent from '../../handler/kifu/getCurrent'\nimport pushMove from '../../handler/kifu/pushMove'\nimport { getTargets } from '../../lib/validatior/getTargets'\nimport { find } from '../../lib/validatior/utils/algorithm'\nimport filterTargets from '../../lib/validatior/utils/filterTargets'\nimport { ClickProps } from '../../model/events/ClickProps'\nimport { MoveProps } from '../../model/events/MoveProps'\nimport Kifu, { newKifu } from '../../model/kifu/Kifu'\nimport { Move } from '../../model/kifu/Move'\nimport Confirm from '../../model/shogi/Confirm'\nimport { Piece } from '../../model/shogi/Piece'\nimport Point from '../../model/shogi/Point'\nimport { Position } from '../../model/shogi/Position'\nimport { Gote, Sente, Turn } from '../../model/shogi/Turn'\nimport { GameState } from '../GameState'\n\nexport class DefaultGameState implements GameState {\n  @observable indexes: number[] = [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n  @observable selected: Point | null = null\n  @observable confirm: Confirm | null = null\n  @observable moveTargets: Point[] = []\n  @observable kifu: Kifu = newKifu()\n  @observable prevDestination: Point | null = null\n\n  @computed get currentMove(): Move {\n    return getCurrent(this.kifu)\n  }\n\n  @action reverse(): void {\n    this.indexes = this.indexes.slice().reverse()\n  }\n\n  @action clickPiece(p: ClickProps): void {\n    const sel: Point | null = this.selected\n    const turn: Turn = this.currentMove.pos.turn\n\n    // Confirm 画面なのに、成・不成以外がクリックされたらなにもしない\n    if (!!this.confirm && isPiece(p.clicked)) return\n\n    // 選択された駒をクリックしたら選択解除\n    if (!!sel && isPiece(p.clicked) && selectedAgain(sel, p)) {\n      this.selected = null\n      this.moveTargets = []\n      return\n    }\n\n    // 手番側の駒なら選択する\n    if (isPiece(p.clicked) && ownerIsTurn(p.clicked, turn)) {\n      const { row, column, clicked, i } = p\n      const point: Point = { row, column, piece: clicked, i }\n      this.selected = point\n      const targets = getTargets(this.currentMove.pos, point)\n      const filtered = filterTargets(this.currentMove.pos, point, targets)\n      this.moveTargets = filtered\n      return\n    }\n\n    // 選択された駒がない場合は、手番ではない方の駒or空白マスがクリックされた\n    // ということなので何もしない\n    // `|| sel.piece === undefined` の部分は\n    // この後のコードで TypeScript のチェックを楽にするため\n    if (!sel || !sel.piece) return\n\n    // 動けない場所がクリックされたらなにもしない\n    const foundIndex: number = find(this.moveTargets, p)\n    if (foundIndex === -1) return\n\n    const source: Point = { row: sel.row, column: sel.column }\n    const dest: Point = { row: p.row, column: p.column }\n\n    const moveAndUpdateState = (piece: Piece, promote?: boolean) => {\n      this.prevDestination = dest\n      const moveProps: MoveProps = {\n        pos: this.currentMove.pos,\n        source,\n        dest,\n        prevDest: this.currentMove.dest,\n        piece,\n        promote,\n      }\n      const pos: Position = move(moveProps)\n      const kifuStr: string = genKifuString(moveProps)\n      const moveForKifu: Move = {\n        index: this.currentMove.index + 1,\n        str: kifuStr,\n        pos,\n        source,\n        dest,\n        piece,\n        promote,\n      }\n      this.selected = null\n      this.confirm = null\n      this.moveTargets = []\n      this.kifu = pushMove(this.kifu, moveForKifu)\n    }\n\n    // Confirm オブジェクトがクリックされたら動かす(成 or 不成の処理)\n    if (!isPiece(p.clicked)) {\n      const piece: Piece = p.promote ? p.clicked.promoted : p.clicked.preserved\n      moveAndUpdateState(piece, p.promote === true)\n      return\n    }\n\n    // 成を選択できるか\n    const cp: boolean = canPromote({\n      sourceRow: sel.row,\n      destRow: p.row,\n      piece: sel.piece,\n    })\n\n    // 強制的に成る必要があるか\n    const mp: boolean = mustPromote(sel.piece, p.row)\n\n    // 成・不成の選択ができるように、Confirm オブジェクトをセット\n    if (cp && !mp) {\n      this.confirm = {\n        promoted: promote(sel.piece),\n        preserved: sel.piece,\n        row: p.row,\n        column: p.column,\n      }\n      return\n    }\n\n    const piece: Piece = mp ? promote(sel.piece) : sel.piece\n    moveAndUpdateState(piece, mp || undefined)\n  }\n\n  @action clickKifu(moveCount: number, branchIndex?: number): void {\n    if (this.confirm) return\n    this.kifu = changeIndex(this.kifu, moveCount, branchIndex)\n    this.selected = null\n    this.moveTargets = []\n  }\n}\n\nfunction isPiece(pc: Piece | Confirm): pc is Piece {\n  return typeof pc === 'number'\n}\n\nfunction ownerIsTurn(p: Piece, t: Turn): boolean {\n  return (p < 0 && t === Gote) || (p > 0 && t === Sente)\n}\n\nfunction selectedAgain(sel: Point, cp: ClickProps): boolean {\n  return (\n    sel.row === cp.row &&\n    sel.column === cp.column &&\n    sel.piece === cp.clicked &&\n    sel.i === cp.i\n  )\n}\n","import { Fu0, Gyoku0, Piece } from '../../../model/shogi/Piece'\nimport Point from '../../../model/shogi/Point'\nimport { Position } from '../../../model/shogi/Position'\nimport { Gote, Sente, Turn } from '../../../model/shogi/Turn'\nimport { moveBoardOnly } from '../../../handler/game/position'\nimport { getTargets } from '../getTargets'\nimport getGyokuPoint from './getGyokuPoint'\nimport isPointed from './isPointed'\n\n/**\n * 王手放置か打ち歩詰めだったら弾く\n * @param pos Position 動かす前の配置\n * @param point Point 動かしたい駒の場所情報\n * @param targets point を getTargets で取得したリスト\n * @returns targets にフィルターをかけた結果\n */\nexport default function filter(\n  pos: Position,\n  point: Point,\n  targets: Point[]\n): Point[] {\n  if (!point.piece) throw new Error('piece id is needed')\n\n  const turn: Turn = point.piece > 0 ? Sente : Gote\n\n  // 手番側の玉がある場所。駒を動かしたとき王手放置にならないようにメモしておく\n  let gp = getGyokuPoint(pos.pos, turn)\n\n  // 王手放置・打ち歩詰めチェックを通った場所を入れていく\n  const filtered: Point[] = []\n\n  for (let i = 0; i < targets.length; i++) {\n    // 盤上だけ動かす\n    const moved: Position = moveBoardOnly({\n      pos: pos,\n      source: { row: point.row, column: point.column },\n      dest: { row: targets[i].row, column: targets[i].column },\n      piece: point.piece as Piece,\n    })\n\n    // 玉自身の動きチェックをしていたら、玉が動くので、再セット\n    if (point.piece && Math.abs(point.piece) === Gyoku0)\n      gp = getGyokuPoint(moved.pos, turn)\n\n    // 王手放置ならpushしない\n    const isOute = gp !== undefined && isPointed(moved, gp, -turn as Turn)\n    if (isOute) continue\n\n    // 打ち歩詰めチェック\n    const isFu: boolean = Math.abs(point.piece) === Fu0\n    const isFromCapture: boolean = point.row === -1\n    const enemyGyoku = getGyokuPoint(moved.pos, -turn as Turn)\n    // 打った歩による王手である\n    if (\n      isFu &&\n      isFromCapture &&\n      enemyGyoku !== undefined &&\n      isPointed(moved, enemyGyoku, turn)\n    ) {\n      // 打った歩が次に取られるか\n      const fuIsPointed = isPointed(moved, targets[i], -turn as Turn)\n\n      // 相手玉が逃げられる場所があるか\n      const enemyGyokuTargets = getTargets(moved, enemyGyoku)\n      const filteredEnemyGyokuTargets = filter(\n        moved,\n        enemyGyoku,\n        enemyGyokuTargets\n      )\n\n      // 打った歩が取られない && 逃げ場所がないとき、打ち歩詰めである\n      if (!fuIsPointed && filteredEnemyGyokuTargets.length === 0) continue\n    }\n\n    // OK\n    filtered.push(targets[i])\n  }\n\n  return filtered\n}\n","import History, { isBranch, KifuComponent } from '../../model/kifu/History'\nimport Kifu from '../../model/kifu/Kifu'\nimport { Move } from '../../model/kifu/Move'\n\n/**\n * 棋譜の現在表示局面のMoveを返す\n * 開始局面は0なので、3手目を表示中なら3と3手目のMoveが返る\n * @param k Kif\n */\nexport default function (k: Kifu): Move {\n  let history: History = k.history\n  let moveOrBranch: KifuComponent = history.moves[history.index]\n\n  while (isBranch(moveOrBranch)) {\n    history = moveOrBranch.branches[moveOrBranch.index]\n    moveOrBranch = history.moves[history.index]\n  }\n\n  return moveOrBranch\n}\n","import { Position } from '../shogi/Position'\nimport { hirate } from '../shogi/PositionInit'\nimport History from './History'\nimport Meta from './Meta'\n\nexport default interface Kifu {\n  // 対局者などの対局情報\n  meta: Meta\n\n  // 棋譜\n  history: History\n}\n\nexport function newKifu(): Kifu {\n  const initPos: Position = hirate()\n  return {\n    meta: {\n      version: '1',\n      player: { sente: '', gote: '' },\n      handicap: '平手',\n      initPos,\n    },\n    history: {\n      // TODO: 持ち方考える\n      moves: [\n        {\n          index: 0,\n          str: '開始局面',\n          pos: initPos,\n          source: { row: -1, column: -1 }, // 盤上に存在しない場所にしておく\n          dest: { row: -1, column: -1 },\n          piece: 0,\n        },\n      ],\n      index: 0,\n    },\n  }\n}\n","import {\n  Empty,\n  Fu0,\n  Fu1,\n  Gin0,\n  Gin1,\n  Gyoku0,\n  Gyoku1,\n  Hisha0,\n  Hisha1,\n  Kaku0,\n  Kaku1,\n  Kei0,\n  Kei1,\n  Kin0,\n  Kin1,\n  Kyou0,\n  Kyou1,\n} from './Piece'\nimport { Position } from './Position'\nimport { Sente } from './Turn'\n\n/**\n * 初期局を返す\n * column は reverse() されているので、\n * 飛車と角の位置が逆に見える\n * 棋譜との互換性を保つため。\n * ３三角 → pos[2][2]、\n * ３四飛 → pos[3][2]、\n * ７六歩 → pos[5][6] という感じで変換が楽\n */\nexport function hirate(): Position {\n  return {\n    // prettier-ignore\n    pos: [\n      [Kyou1, Kei1,   Gin1,  Kin1,  Gyoku1, Kin1,  Gin1,  Kei1,   Kyou1],\n      [Empty, Kaku1,  Empty, Empty, Empty,  Empty, Empty, Hisha1, Empty],\n      [Fu1,   Fu1,    Fu1,   Fu1,   Fu1,    Fu1,   Fu1,   Fu1,    Fu1  ],\n      [Empty, Empty,  Empty, Empty, Empty,  Empty, Empty, Empty,  Empty],\n      [Empty, Empty,  Empty, Empty, Empty,  Empty, Empty, Empty,  Empty],\n      [Empty, Empty,  Empty, Empty, Empty,  Empty, Empty, Empty,  Empty],\n      [Fu0,   Fu0,    Fu0,   Fu0,   Fu0,    Fu0,   Fu0,   Fu0,    Fu0  ],\n      [Empty, Hisha0, Empty, Empty, Empty,  Empty, Empty, Kaku0,  Empty],\n      [Kyou0, Kei0,   Gin0,  Kin0,  Gyoku0, Kin0,  Gin0,  Kei0,   Kyou0],\n    ],\n    cap0: [0, 0, 0, 0, 0, 0, 0],\n    cap1: [0, 0, 0, 0, 0, 0, 0],\n    turn: Sente,\n    moveCount: 0,\n  }\n}\n","import { observable, observe } from 'mobx'\nimport { createContext } from 'react'\nimport { Connected } from '../model/engine/State'\nimport { Move } from '../model/kifu/Move'\nimport { Config } from './Config'\nimport { DisplayState } from './DisplayState'\nimport { EngineState } from './EngineState'\nimport { GameState } from './GameState'\nimport { DefaultConfig } from './impl/Config'\nimport { DefaultDisplayState } from './impl/DisplayState'\nimport { DefaultEngineState } from './impl/EngineState'\nimport { DefaultGameState } from './impl/GameState'\n\nexport interface Store {\n  gameState: GameState\n  engineState: EngineState\n  displayState: DisplayState\n  config: Config\n\n  /**\n   * 将棋エンジンに対して setPosition を実行する\n   * @param move move が渡されなかった場合 gameState から局面を取得し実行する\n   *             move を渡さないのは connect 実行後に一度だけの想定\n   */\n  updatePosition(move?: Move): Promise<void>\n}\n\nclass DefaultStore implements Store {\n  constructor() {\n    this.engineState.setServerURL(this.config.serverURL)\n\n    // gameState で現在局面に変更があったら、将棋エンジンに局面をセットする\n    observe(this.gameState, 'currentMove', change =>\n      this.updatePosition(change.newValue)\n    )\n\n    // config の serverURL に変更があったら、engineState の serverURL を更新する\n    observe(this.config, 'serverURL', change =>\n      this.engineState.setServerURL(change.newValue)\n    )\n  }\n\n  @observable gameState: GameState = new DefaultGameState()\n  @observable engineState: EngineState = new DefaultEngineState()\n  @observable displayState: DisplayState = new DefaultDisplayState()\n  @observable config: Config = new DefaultConfig()\n\n  async updatePosition(move?: Move): Promise<void> {\n    const setPositionExecutable: boolean = this.engineState.state >= Connected\n    if (!setPositionExecutable) return\n\n    const m: Move = move || this.gameState.currentMove\n    this.engineState.updatePosition(m.pos)\n  }\n}\n\nexport const defaultStore: () => Store = () => new DefaultStore()\nexport const StoreContext = createContext<Store>(defaultStore())\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { genKifuString } from '../../../handler/kifu/genKifuString'\nimport { StoreContext } from '../../../store/Store'\nimport './Columns.scss'\nimport Point from '../../../model/shogi/Point'\n\nconst Columns: FC = () => {\n  const { engineState, gameState } = React.useContext(StoreContext)\n  const { result } = engineState\n  if (!result) return <div />\n\n  const columns = result.map(i => {\n    let prevDest: Point | null = gameState.prevDestination\n    const moves = i.moves.map((m, n) => {\n      if (prevDest) m.prevDest = prevDest\n      const kifu = genKifuString(m)\n      prevDest = m.dest\n      // TODO: key\n      return (\n        <div key={n} className=\"EngineInfoRowContent\">\n          {kifu}\n        </div>\n      )\n    })\n\n    return (\n      <div key={i.id} className=\"EngineInfoColumn\">\n        <div className=\"EngineInfoRow EngineInfoRowContainer\">\n          <div className=\"EngineInfoRowLabel\">score</div>\n          <div className=\"EngineInfoRowContent Center\">{i.score}</div>\n        </div>\n        <div className=\"EngineInfoRow EngineInfoRowContainer\">\n          <div className=\"EngineInfoRowLabel\">読み</div>\n          {moves}\n        </div>\n      </div>\n    )\n  })\n\n  return <>{columns}</>\n}\n\nexport default observer(Columns)\n","import React, { FC } from 'react'\nimport Columns from './Columns'\nimport './SideInfo.scss'\n\nconst SideInfo: FC = () => {\n  return (\n    <div className=\"EngineSideInfo\">\n      <div className=\"EngineSideInfoContainer\">\n        <Columns />\n      </div>\n    </div>\n  )\n}\n\nexport default SideInfo\n","import { observer } from 'mobx-react-lite'\nimport React, { FC, useEffect, useRef } from 'react'\nimport { StoreContext } from '../../store/Store'\nimport './WidthController.scss'\n\nconst Setting: FC = () => {\n  const { displayState, config } = React.useContext(StoreContext)\n  const displayStateRef = useRef(displayState)\n  const configRef = useRef(config)\n\n  const resizeOn = () => displayState.setResizing(true)\n  const resizeOff = () => {\n    const ds = displayStateRef.current\n    if (ds.resizing) window.getSelection()?.removeAllRanges()\n    displayStateRef.current.setResizing(false)\n  }\n  const onMove = (e: MouseEvent) => {\n    const displayState = displayStateRef.current\n    if (!displayState.resizing) return\n    const config = configRef.current\n\n    const container = document.getElementById('root') as HTMLDivElement\n    const containerWidth = container.clientWidth\n    const pos = containerWidth - e.clientX\n    if (pos <= 0) config.setAppWidth()\n    else config.setAppWidth(containerWidth - pos * 2)\n  }\n\n  useEffect(() => {\n    document.addEventListener('mouseup', () => resizeOff())\n    document.addEventListener('mousemove', e => onMove(e))\n  }, [])\n\n  return <div className=\"WidthController\" onMouseDown={resizeOn} />\n}\n\nexport default observer(Setting)\n","import React, { FC } from 'react'\nimport './Mockup.scss'\n\ninterface Props {\n  onClick: () => Promise<void>\n}\n\nconst CloseButton: FC<Props> = (props: Props) => {\n  const width = 20\n  const one = line(0, 0, width, width)\n  const two = line(width, 0, 0, width)\n\n  return (\n    <div onClick={() => props.onClick()}>\n      <svg width={width} height={width} className=\"MockupCloseButton\">\n        {one}\n        {two}\n      </svg>\n    </div>\n  )\n\n  function line(x1: number, y1: number, x2: number, y2: number) {\n    return (\n      <line x1={x1} y1={y1} x2={x2} y2={y2} stroke=\"black\" strokeWidth=\"2\" />\n    )\n  }\n}\n\nexport default CloseButton\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport './Button.scss'\n\nexport interface Props {\n  label: string\n  onClick: () => Promise<void>\n}\n\nconst Button: FC<Props> = (props: Props) => {\n  return (\n    <button className=\"FormButton\" onClick={() => props.onClick()}>\n      {props.label}\n    </button>\n  )\n}\n\nexport default observer(Button)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { ShogiBoardClient } from '../../../../infrastructure/ShogiBoardClient'\nimport { Button as OptionButton } from '../../../../model/engine/Optoin'\nimport Button from '../../../form/Button'\nimport './Buttons.scss'\n\nexport interface Props {\n  buttons: Map<string, OptionButton>\n  sbclient: ShogiBoardClient\n}\n\nconst Buttons: FC<Props> = (props: Props) => {\n  const buttons = Array.from(props.buttons)\n  const elms: JSX.Element[] = buttons.map(([name, option]) => {\n    const onClick = () => props.sbclient.updateButton(option)\n    return <Button key={name} label={name} onClick={onClick} />\n  })\n\n  return <div className=\"OptionButton\">{elms}</div>\n}\n\nexport default observer(Buttons)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport './Check.scss'\n\nexport interface Props {\n  label: string\n  value: boolean\n  name: string\n  onChange: (b: boolean) => Promise<void>\n}\n\nconst Check: FC<Props> = (props: Props) => {\n  const { label, value, name } = props\n  const id = `FormCheck-${name}`\n\n  return (\n    <div className=\"FormCheck\">\n      <span>{label}</span>\n      <div className=\"FormCheckToggle\">\n        <input\n          id={id}\n          name={id}\n          type=\"checkbox\"\n          onChange={e => props.onChange(e.target.checked)}\n          checked={value}\n        />\n        <label htmlFor={id}>\n          <div\n            className=\"ToggleSwitch\"\n            data-checked=\"ON\"\n            data-unchecked=\"OFF\"\n          />\n        </label>\n      </div>\n    </div>\n  )\n}\n\nexport default observer(Check)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { ShogiBoardClient } from '../../../../infrastructure/ShogiBoardClient'\nimport { Check as OptionCheck } from '../../../../model/engine/Optoin'\nimport Check from '../../../form/Check'\n\nexport interface Props {\n  checks: Map<string, OptionCheck>\n  sbclient: ShogiBoardClient\n}\n\nconst Checks: FC<Props> = (props: Props) => {\n  const checks = Array.from(props.checks)\n  const elms: JSX.Element[] = checks.map(([name, option]) => {\n    const onChange = (b: boolean) => {\n      option.setValue(b)\n      return props.sbclient.updateCheck(option)\n    }\n\n    return (\n      <Check\n        key={name}\n        label={name}\n        name={name}\n        value={option.value}\n        onChange={onChange}\n      />\n    )\n  })\n\n  return <div>{elms}</div>\n}\n\nexport default observer(Checks)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { ShogiBoardClient } from '../../../../infrastructure/ShogiBoardClient'\nimport { Range as OptionRange } from '../../../../model/engine/Optoin'\n\nexport interface Props {\n  option: OptionRange\n  sbclient: ShogiBoardClient\n}\n\nconst Range: FC<Props> = (props: Props) => {\n  const { name, value, inputValue, min, max } = props.option\n  // inputValue が Number && inRange のとき、 val に値をセットするようにしているため\n  // val と inputValue が一致していれば正しい値\n  const isValid: boolean = value.toString() === inputValue\n  const className: string =\n    'FormTextInput' + (isValid ? '' : ' FormTextInvalid')\n  const labelText: string = `${name}(${min}~${max})`\n\n  const onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { option, sbclient } = props\n    option.setValue(e.target.value)\n    return sbclient.updateRange(option)\n  }\n\n  return (\n    <div className=\"FormText\">\n      <input\n        className={className}\n        type=\"text\"\n        value={inputValue}\n        placeholder=\" \"\n        onChange={onChange}\n        required\n        min={min}\n        max={max}\n      />\n      <label>{labelText}</label>\n    </div>\n  )\n}\n\nexport default observer(Range)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { ShogiBoardClient } from '../../../../infrastructure/ShogiBoardClient'\nimport { Range as OptionRange } from '../../../../model/engine/Optoin'\nimport Range from './Range'\n\nexport interface Props {\n  ranges: Map<string, OptionRange>\n  sbclient: ShogiBoardClient\n}\n\nconst Ranges: FC<Props> = (props: Props) => {\n  const { ranges, sbclient } = props\n\n  const elms: JSX.Element[] = Array.from(ranges).map(([name, option]) => (\n    <Range key={name} option={option} sbclient={sbclient} />\n  ))\n\n  return <div>{elms}</div>\n}\n\nexport default observer(Ranges)\n","import { observer } from 'mobx-react-lite'\nimport React, { ChangeEvent, FC } from 'react'\nimport './Select.scss'\n\nexport interface Props {\n  label: string\n  value: string\n  options: string[]\n  onChange: (s: string) => Promise<void>\n}\n\nconst Select: FC<Props> = (props: Props) => {\n  const { label, value, options } = props\n  const opts = options.map((value: string, i: number) => (\n    <option key={i} value={value}>\n      {value}\n    </option>\n  ))\n\n  const onChange = (e: ChangeEvent<HTMLSelectElement>) => {\n    props.onChange(e.target.value)\n  }\n\n  return (\n    <div className=\"FormSelectContainer\">\n      <label>{label}</label>\n      <div className=\"FormSelect SelectTriangle\">\n        <select onChange={onChange} value={value} required>\n          {opts}\n        </select>\n      </div>\n    </div>\n  )\n}\n\nexport default observer(Select)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { ShogiBoardClient } from '../../../../infrastructure/ShogiBoardClient'\nimport { Select as OptionSelect } from '../../../../model/engine/Optoin'\nimport Select from '../../../form/Select'\n\nexport interface Props {\n  selects: Map<string, OptionSelect>\n  sbclient: ShogiBoardClient\n}\n\nconst Selects: FC<Props> = (props: Props) => {\n  const selects = Array.from(props.selects)\n\n  const elms: JSX.Element[] = selects.map(([name, option]) => {\n    const onChange = (s: string) => {\n      option.setValue(s)\n      return props.sbclient.updateSelect(option)\n    }\n\n    return (\n      <Select\n        key={name}\n        label={name}\n        value={option.value}\n        options={option.vars}\n        onChange={onChange}\n      />\n    )\n  })\n\n  return <div>{elms}</div>\n}\n\nexport default observer(Selects)\n","import { observer } from 'mobx-react-lite'\nimport React, { ChangeEvent, FC } from 'react'\nimport './Text.scss'\n\nexport interface Props {\n  value: string\n  label: string\n  onChange: (s: string) => Promise<void>\n  allowEmpty?: boolean\n  placeholder?: string\n}\n\nconst Text: FC<Props> = (props: Props) => {\n  const { value, label, allowEmpty, placeholder } = props\n\n  const classes = ['FormTextInput']\n  if (!allowEmpty && value === '') classes.push('FormTextInvalid')\n  const className: string = classes.join(' ')\n\n  const onChange = (e: ChangeEvent<HTMLInputElement>) => {\n    props.onChange(e.target.value)\n  }\n\n  return (\n    <div className=\"FormText\">\n      <input\n        className={className}\n        type=\"text\"\n        value={value}\n        placeholder={placeholder || ' '}\n        onChange={onChange}\n        required\n      />\n      <label>{label}</label>\n    </div>\n  )\n}\n\nexport default observer(Text)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { ShogiBoardClient } from '../../../../infrastructure/ShogiBoardClient'\nimport { Text as OptionText } from '../../../../model/engine/Optoin'\nimport Text from '../../../form/Text'\n\nexport interface Props {\n  texts: Map<string, OptionText>\n  sbclient: ShogiBoardClient\n}\n\nconst Texts: FC<Props> = (props: Props) => {\n  const texts = Array.from(props.texts)\n\n  const strElms: JSX.Element[] = texts.map(([name, option]) => {\n    const onChange = (s: string) => {\n      option.setValue(s)\n      return props.sbclient.updateText(option)\n    }\n\n    return (\n      <Text key={name} label={name} value={option.value} onChange={onChange} />\n    )\n  })\n\n  return <div>{strElms}</div>\n}\n\nexport default observer(Texts)\n","import interval from 'interval-promise'\nimport { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { Info } from '../../../model/engine/Info'\nimport { Thinking } from '../../../model/engine/State'\nimport { EngineState } from '../../../store/EngineState'\nimport { Store, StoreContext } from '../../../store/Store'\nimport './Detail.scss'\nimport Buttons from './form/Buttons'\nimport Checks from './form/Checks'\nimport Ranges from './form/Ranges'\nimport Selects from './form/Selects'\nimport Texts from './form/Texts'\n\nconst GET_RESULT_INTERVAL = 1000 // ms\n\nconst Detail: FC = () => {\n  const { gameState, displayState, engineState }: Store =\n    React.useContext(StoreContext)\n  const { current, options, sbclient }: EngineState = engineState\n  if (!current || !options) return <div />\n\n  const { buttons, checks, ranges, selects, texts } = options\n\n  const disconnect = () => engineState.disconnect()\n  const start = () =>\n    engineState\n      .startThinking()\n      .then(() => displayState.closeMockup())\n      .then(fetchInterval)\n      .catch(e => console.error(e))\n\n  const disconnectBtn = (\n    <button className=\"ButtonDisconnect\" onClick={disconnect}>\n      接続解除\n    </button>\n  )\n\n  const startBtn = (\n    <button className=\"ButtonStartThinking\" onClick={start}>\n      思考開始\n    </button>\n  )\n\n  return (\n    <div className=\"DetailContainer\">\n      <h1 className=\"EngineName\">{current}</h1>\n      {disconnectBtn}\n      {startBtn}\n      <h2 className=\"EngineOption\">オプション</h2>\n      <Buttons buttons={buttons} sbclient={sbclient} />\n      <Checks checks={checks} sbclient={sbclient} />\n      <Ranges ranges={ranges} sbclient={sbclient} />\n      <Selects selects={selects} sbclient={sbclient} />\n      <Texts texts={texts} sbclient={sbclient} />\n      {disconnectBtn}\n      {startBtn}\n    </div>\n  )\n\n  function fetchInterval(): Promise<void> {\n    // 思考を開始したら、思考結果を定期的に取得する\n    return interval(async (_, stop) => {\n      const { current, state, sbclient } = engineState\n      if (!current || state !== Thinking) {\n        stop()\n        return\n      }\n\n      try {\n        const result: Info[] = await sbclient.getResult(gameState.currentMove)\n        await engineState.setResult(result)\n      } catch (e) {\n        console.error(e)\n      }\n    }, GET_RESULT_INTERVAL)\n  }\n}\n\nexport default observer(Detail)\n","import React, { FC } from 'react'\nimport './Loader.scss'\n\nconst Loader: FC = () => {\n  return (\n    <div className=\"Loader sk-fading-circle\">\n      <div className=\"sk-circle1 sk-circle\" />\n      <div className=\"sk-circle2 sk-circle\" />\n      <div className=\"sk-circle3 sk-circle\" />\n      <div className=\"sk-circle4 sk-circle\" />\n      <div className=\"sk-circle5 sk-circle\" />\n      <div className=\"sk-circle6 sk-circle\" />\n      <div className=\"sk-circle7 sk-circle\" />\n      <div className=\"sk-circle8 sk-circle\" />\n      <div className=\"sk-circle9 sk-circle\" />\n      <div className=\"sk-circle10 sk-circle\" />\n      <div className=\"sk-circle11 sk-circle\" />\n      <div className=\"sk-circle12 sk-circle\" />\n    </div>\n  )\n}\n\nexport default Loader\n","import { observer } from 'mobx-react-lite'\nimport React, { FC, useEffect, useRef } from 'react'\nimport { Connecting, NotConnected, State } from '../../../model/engine/State'\nimport { Store } from '../../../store/Store'\nimport { StoreContext } from '../../../store/Store'\nimport Loader from '../../util/Loader'\nimport './List.scss'\n\nconst List: FC = () => {\n  const store: Store = React.useContext(StoreContext)\n  const { engineState } = store\n  const latestEngineState = useRef(engineState)\n  const { names, current, state } = engineState\n\n  useEffect(() => {\n    const engineState = latestEngineState.current\n    engineState.sbclient\n      .init()\n      .then((list: string[]) => engineState.setNames(list))\n      .catch(err => {\n        const msg = [\n          '接続に失敗しました。以下を確認してください。',\n          '1. サーバーが起動しているか',\n          '2. サーバーのURLが正しいか',\n          '3. サーバーのログを確認し、エラー等が出ていないか',\n          '4. サーバーで将棋エンジンの実行パスを設定したか',\n          '5. 将棋エンジンが実行可能であるか',\n        ].join('\\n')\n        console.error(err)\n        engineState.disconnect()\n        alert(msg)\n      })\n  }, [])\n\n  if (names.length === 0)\n    return (\n      <div className=\"ListEngineName\">\n        <span>利用可能な将棋エンジンが設定されていません</span>\n      </div>\n    )\n\n  const engineNames = names.map((name, i) => {\n    const isCurrent: boolean = name === current\n    const loading: boolean = isCurrent && state === Connecting\n    const loader = loading ? <Loader /> : undefined\n    const onClick = () => setCurrentEngine(name, state)\n    return (\n      <div className=\"ListEngineName\" key={i} onClick={onClick}>\n        {loader}\n        <span>{name}</span>\n      </div>\n    )\n  })\n\n  return <>{engineNames}</>\n\n  async function setCurrentEngine(name: string, state: State): Promise<void> {\n    if (state !== NotConnected) return\n    await engineState.connect(name)\n    await store.updatePosition().catch(e => console.error(e))\n  }\n}\n\nexport default observer(List)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { MockupHidden } from '../../../model/display/MockupState'\nimport { Connecting, NotConnected } from '../../../model/engine/State'\nimport { EngineState } from '../../../store/EngineState'\nimport { Store, StoreContext } from '../../../store/Store'\nimport CloseButton from '../../util/CloseButton'\nimport Detail from './Detail'\nimport List from './List'\n\nconst Controller: FC = () => {\n  const { engineState, displayState }: Store = React.useContext(StoreContext)\n  const { state }: EngineState = engineState\n\n  // 接続前なら将棋エンジンの一覧画面を出す\n  const isList: boolean = state === NotConnected || state === Connecting\n  const child: JSX.Element = isList ? <List /> : <Detail />\n\n  const onClick = () => displayState.setMockupState(MockupHidden)\n\n  return (\n    <div className=\"Mockup\">\n      <CloseButton onClick={onClick} />\n      {child}\n    </div>\n  )\n}\n\nexport default observer(Controller)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { MockupHidden } from '../../model/display/MockupState'\nimport { StoreContext } from '../../store/Store'\nimport Check from '../form/Check'\nimport Text from '../form/Text'\nimport CloseButton from '../util/CloseButton'\n\nconst Setting: FC = () => {\n  const { config, displayState } = React.useContext(StoreContext)\n  const { paintTargets, serverURL, saveToLocalStorage, saveBoardWidth } = config\n\n  return (\n    <div className=\"Mockup\">\n      <CloseButton onClick={() => displayState.setMockupState(MockupHidden)} />\n      <h1>設定</h1>\n      <Text\n        label=\"shogi-board-server の URL\"\n        value={serverURL}\n        allowEmpty={true}\n        onChange={s => config.setServerURL(s)}\n        placeholder=\"(例)http://localhost:8080\"\n      />\n      <Check\n        label=\"駒が移動できるマスに色を付ける\"\n        value={paintTargets}\n        name=\"PaintTargets\"\n        onChange={b => config.setPaintTargets(b)}\n      />\n      <Check\n        label=\"ブラウザに設定を保存する\"\n        value={saveToLocalStorage}\n        name=\"SaveToLocalStorage\"\n        onChange={b => config.setSaveToLocalStorage(b)}\n      />\n      <Check\n        label=\"幅を記憶する\"\n        value={saveBoardWidth}\n        name=\"SaveBoardWidth\"\n        onChange={b => config.setSaveBoardWidth(b)}\n      />\n    </div>\n  )\n}\n\nexport default observer(Setting)\n","import { observer } from 'mobx-react-lite'\nimport React, { CSSProperties, FC } from 'react'\nimport Column1Img from '../../img/components/columns/1.svg'\nimport Column2Img from '../../img/components/columns/2.svg'\nimport Column3Img from '../../img/components/columns/3.svg'\nimport Column4Img from '../../img/components/columns/4.svg'\nimport Column5Img from '../../img/components/columns/5.svg'\nimport Column6Img from '../../img/components/columns/6.svg'\nimport Column7Img from '../../img/components/columns/7.svg'\nimport Column8Img from '../../img/components/columns/8.svg'\nimport Column9Img from '../../img/components/columns/9.svg'\nimport Row1Img from '../../img/components/rows/1.svg'\nimport Row2Img from '../../img/components/rows/2.svg'\nimport Row3Img from '../../img/components/rows/3.svg'\nimport Row4Img from '../../img/components/rows/4.svg'\nimport Row5Img from '../../img/components/rows/5.svg'\nimport Row6Img from '../../img/components/rows/6.svg'\nimport Row7Img from '../../img/components/rows/7.svg'\nimport Row8Img from '../../img/components/rows/8.svg'\nimport Row9Img from '../../img/components/rows/9.svg'\nimport { find } from '../../lib/validatior/utils/algorithm'\nimport { ClickProps } from '../../model/events/ClickProps'\nimport Confirm from '../../model/shogi/Confirm'\nimport { Empty, Piece } from '../../model/shogi/Piece'\nimport Point from '../../model/shogi/Point'\nimport { Gote, Sente, Turn } from '../../model/shogi/Turn'\nimport { StoreContext } from '../../store/Store'\nimport './Cell.scss'\n\nexport interface Props {\n  row: number\n  column: number\n}\n\nconst Cell: FC<Props> = (props: Props) => {\n  const { gameState, config } = React.useContext(StoreContext)\n  const { indexes, selected, confirm, currentMove, moveTargets } = gameState\n  const { row, column } = props\n\n  const getPiece = () => {\n    const isOnBoard: boolean = inRange(row) && inRange(column)\n    if (!isOnBoard) return Empty\n    return gameState.currentMove.pos.pos[row][column]\n  }\n\n  const piece: Piece = getPiece()\n\n  const turn: Turn = currentMove.pos.turn\n  const isTurn: boolean =\n    (piece > 0 && turn === Sente) || (piece < 0 && turn === Gote)\n\n  // 着色する設定 && 駒が移動できるマスである\n  const isTargeted =\n    config.paintTargets && find(moveTargets, { row, column }) !== -1\n\n  const className: string = getClassName({\n    r: row,\n    c: column,\n    rv: indexes[0] === 9,\n    p: piece,\n    sel: selected,\n    confirm: confirm,\n    isTurn,\n    isTargeted,\n  })\n\n  const bgImg = (url: string) => ({ backgroundImage: `url(${url})` })\n  let style: CSSProperties | undefined\n  if (inRange(column) && row === -1) {\n    if (column === 0) style = bgImg(Column1Img)\n    else if (column === 1) style = bgImg(Column2Img)\n    else if (column === 2) style = bgImg(Column3Img)\n    else if (column === 3) style = bgImg(Column4Img)\n    else if (column === 4) style = bgImg(Column5Img)\n    else if (column === 5) style = bgImg(Column6Img)\n    else if (column === 6) style = bgImg(Column7Img)\n    else if (column === 7) style = bgImg(Column8Img)\n    else style = bgImg(Column9Img)\n  } else if (inRange(row) && column === -1) {\n    if (row === 0) style = bgImg(Row1Img)\n    else if (row === 1) style = bgImg(Row2Img)\n    else if (row === 2) style = bgImg(Row3Img)\n    else if (row === 3) style = bgImg(Row4Img)\n    else if (row === 4) style = bgImg(Row5Img)\n    else if (row === 5) style = bgImg(Row6Img)\n    else if (row === 6) style = bgImg(Row7Img)\n    else if (row === 7) style = bgImg(Row8Img)\n    else style = bgImg(Row9Img)\n  }\n\n  return (\n    <div className={className} onClick={() => click()} style={style}>\n      {renderConfirm(confirm)}\n    </div>\n  )\n\n  function renderConfirm(cf: Confirm | null): JSX.Element | undefined {\n    if (!cf || cf.row !== row || cf.column !== column) return\n\n    const isReversed: boolean = indexes[0] === 9\n    const isGote =\n      (isReversed && cf.preserved > 0) || (!isReversed && cf.preserved < 0)\n\n    const className = 'Piece-Confirm Piece-Confirm' + Number(isGote)\n\n    const promote = () => click(cf, true)\n    const preserve = () => click(cf)\n\n    // TODO: この方法だと画面幅によって1pxずれる\n    return (\n      <div className={className}>\n        <div className=\"Piece-Confirm-Promote\" onClick={promote} />\n        <div className=\"Piece-Confirm-Preserve\" onClick={preserve} />\n      </div>\n    )\n  }\n\n  function click(cf?: Confirm, promote?: true) {\n    if (confirm && !cf) return\n    const clicked: Confirm | Piece = cf || getPiece()\n    const p: ClickProps = { clicked, row, column, promote }\n    gameState.clickPiece(p)\n  }\n}\n\ninterface GetClassNameProps {\n  r: number // row\n  c: number // column\n  rv: boolean // isReversed\n  p: Piece\n  sel: Point | null // selected\n  confirm: Confirm | null\n  isTurn: boolean\n  isTargeted: boolean\n}\n\n// つらい感じ\nfunction getClassName(p: GetClassNameProps): string {\n  const { r, c, sel, confirm, rv, isTurn, isTargeted } = p\n  if (\n    !!confirm &&\n    !!sel &&\n    ((r === sel.row && c === sel.column) ||\n      (r === confirm.row && c === confirm.column))\n  ) {\n    // 成・不成の選択ウィンドウができるとき、元の駒の表示は消す\n    // TODO: ひどい\n    p.p = Empty\n  }\n\n  const classes: string[] = ['Cell']\n\n  const rowInRange: boolean = inRange(r)\n  const colInRange: boolean = inRange(c)\n  const isLeft: boolean = rowInRange && ((!rv && c === 8) || (rv && c === 0))\n  const isTop: boolean = colInRange && ((!rv && r === 0) || (rv && r === 8))\n  const isStar: boolean =\n    (!rv &&\n      ((r === 2 && c === 6) ||\n        (r === 2 && c === 3) ||\n        (r === 5 && c === 6) ||\n        (r === 5 && c === 3))) ||\n    (rv &&\n      ((r === 6 && c === 2) ||\n        (r === 6 && c === 5) ||\n        (r === 3 && c === 2) ||\n        (r === 3 && c === 5)))\n  const isSelected: boolean =\n    rowInRange && colInRange && !!sel && sel.row === r && sel.column === c\n\n  if (rowInRange && colInRange) {\n    classes.push('Piece')\n    classes.push('Piece-Bordered')\n  }\n\n  const rvp: number | undefined = p.p && rv ? p.p * -1 : p.p\n  if (rvp) classes.push(`Piece-${rvp}`)\n  if (isTurn) classes.push('Piece-Turn')\n  if (isSelected) classes.push('Piece-Selected')\n  if (isTargeted) classes.push('Piece-Targeted')\n  if (isLeft) classes.push('Piece-Left')\n  if (isTop) classes.push('Piece-Top')\n\n  const isEdge = (c === -1 && rowInRange) || (r === -1 && colInRange)\n  if (isEdge) classes.push('Cell-Edge')\n  if (isStar) classes.push('Piece-Star')\n\n  return classes.join(' ')\n}\n\nfunction inRange(n: number): boolean {\n  return 0 <= n && n <= 8\n}\n\nexport default observer(Cell)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport {\n  MockupEngineControl,\n  MockupServerSetting,\n  MockupSetting,\n} from '../../model/display/MockupState'\nimport { StoreContext } from '../../store/Store'\nimport Controller from '../engine/connection/Controller'\nimport Setting from '../setting/Setting'\nimport './Board.scss'\nimport Cell from './Cell'\n\nconst Board: FC = () => {\n  const { gameState, displayState } = React.useContext(StoreContext)\n  const idx = gameState.indexes\n  const rows = idx.map(r =>\n    idx\n      .slice()\n      .reverse()\n      .map(c => <Cell key={r * 10 + c} row={r} column={c} />)\n  )\n\n  return (\n    <div className=\"BoardContainer\">\n      <div className=\"ResetPseudo\">\n        <div className=\"Board\">{rows}</div>\n        {renderMockup()}\n      </div>\n    </div>\n  )\n\n  function renderMockup() {\n    const { mockup } = displayState\n    if (mockup === MockupEngineControl) return <Controller />\n    // TODO: server setting は別に分ける？\n    if (mockup === MockupSetting || mockup === MockupServerSetting)\n      return <Setting />\n  }\n}\n\nexport default observer(Board)\n","import History, { isBranch, KifuComponent } from '../../model/kifu/History'\nimport Kifu from '../../model/kifu/Kifu'\n\nexport function getAsString(k: Kifu): string {\n  if (k.history.moves.length < 1) return ''\n  return getRec({\n    moves: k.history.moves.slice(1),\n    index: k.history.index,\n  })\n}\n\nfunction getRec(h: History): string {\n  return h.moves\n    .map((kc: KifuComponent) =>\n      isBranch(kc) ? getRec(kc.branches[kc.index]) : `${kc.index} ${kc.str}`\n    )\n    .join('\\n')\n}\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { getAsString } from '../../handler/kifu/getAsString'\nimport ConfigurationImg from '../../img/components/buttons/configuration.svg'\nimport ConnectToEngineImg from '../../img/components/buttons/connect-to-engine.svg'\nimport CopyKifuImg from '../../img/components/buttons/copy-kifu.svg'\nimport NextFiveImg from '../../img/components/buttons/next-five.svg'\nimport NextOneImg from '../../img/components/buttons/next-one.svg'\nimport PrevFiveImg from '../../img/components/buttons/prev-five.svg'\nimport PrevOneImg from '../../img/components/buttons/prev-one.svg'\nimport ReverseImg from '../../img/components/buttons/reverse.svg'\nimport StopEngineImg from '../../img/components/buttons/stop-engine.svg'\nimport {\n  MockupEngineControl,\n  MockupServerSetting,\n  MockupSetting,\n} from '../../model/display/MockupState'\nimport { Thinking } from '../../model/engine/State'\nimport { StoreContext } from '../../store/Store'\nimport './Buttons.scss'\n\nconst Buttons: FC = () => {\n  const { gameState, displayState, engineState, config } =\n    React.useContext(StoreContext)\n  const { currentMove, kifu } = gameState\n  const i: number = currentMove.index\n\n  const prevOne: number = i - 1 < 0 ? 0 : i - 1\n  const nextOne: number = i + 1\n  const prevFive: number = i - 5 < 0 ? 0 : i - 5\n  const nextFive: number = i + 5\n  const skipKifu = (i: number) => gameState.clickKifu(i)\n\n  const engineOnClick: () => Promise<void> = async () => {\n    const { current, state } = engineState\n    if (!current || state !== Thinking) return await connectToEngine()\n    await engineState.stopThinking()\n  }\n\n  const bgImg = (url: string) => ({ backgroundImage: `url(${url})` })\n\n  return (\n    <div className=\"ButtonsContainer\">\n      <button\n        className=\"PrevOne\"\n        onClick={() => skipKifu(prevOne)}\n        style={bgImg(PrevOneImg)}\n      />\n      <button\n        className=\"NextOne\"\n        onClick={() => skipKifu(nextOne)}\n        style={bgImg(NextOneImg)}\n      />\n      <button\n        className=\"PrevFive\"\n        onClick={() => skipKifu(prevFive)}\n        style={bgImg(PrevFiveImg)}\n      />\n      <button\n        className=\"NextFive\"\n        onClick={() => skipKifu(nextFive)}\n        style={bgImg(NextFiveImg)}\n      />\n      <button\n        className=\"Reverse\"\n        onClick={() => gameState.reverse()}\n        style={bgImg(ReverseImg)}\n      />\n      <button\n        className=\"Copy\"\n        data-clipboard-text={getAsString(kifu)}\n        style={bgImg(CopyKifuImg)}\n      />\n      <button\n        className=\"ConnectToEngine\"\n        onClick={engineOnClick}\n        style={\n          engineState.state === Thinking\n            ? bgImg(StopEngineImg)\n            : bgImg(ConnectToEngineImg)\n        }\n      />\n      <button\n        className=\"Configuration\"\n        onClick={() => displayState.setMockupState(MockupSetting)}\n        style={bgImg(ConfigurationImg)}\n      />\n    </div>\n  )\n\n  async function connectToEngine() {\n    // サーバー URL が設定されてなかったら、設定画面を出す\n    if (config.serverURL === '')\n      return await displayState.setMockupState(MockupServerSetting)\n\n    await displayState.setMockupState(MockupEngineControl)\n  }\n}\n\nexport default observer(Buttons)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport {\n  Fu0,\n  Gin0,\n  Hisha0,\n  Kaku0,\n  Kei0,\n  Kin0,\n  Kyou0,\n  Piece,\n} from '../../model/shogi/Piece'\nimport { Turn } from '../../model/shogi/Turn'\nimport { StoreContext } from '../../store/Store'\nimport './Captures.scss'\n\nexport interface Props {\n  isLeftSide: boolean\n  captures: number[]\n  isTurn: boolean\n}\n\nconst Captures: FC<Props> = (props: Props) => {\n  const { gameState } = React.useContext(StoreContext)\n  const { selected, currentMove } = gameState\n\n  const { captures, isLeftSide, isTurn } = props\n  const className: string = 'Captures Captures' + Number(isLeftSide)\n\n  return (\n    <div className={className}>\n      {cells('Hisha', Hisha0, captures[6])}\n      {cells('Kaku', Kaku0, captures[5])}\n      {cells('Kin', Kin0, captures[4])}\n      {cells('Gin', Gin0, captures[3])}\n      {cells('Kei', Kei0, captures[2])}\n      {cells('Kyou', Kyou0, captures[1])}\n      {cells('Fu', Fu0, captures[0])}\n    </div>\n  )\n\n  function cells(name: string, pieceId: Piece, count: number): JSX.Element {\n    const turn: Turn = currentMove.pos.turn\n\n    const children = Array.from(Array(count).keys()).map(i => {\n      const selectedClass = isTurn ? getSelectedClass(pieceId, i) : ''\n      const isTurnClass = isTurn ? 'Piece-Turn' : ''\n      const piece = isLeftSide ? -pieceId : pieceId\n      const sideNumber = Number(isLeftSide)\n      const captureClass = `Capture-${pieceId}${sideNumber}${count}${i + 1}`\n      const className = `Piece Piece-${piece} ${isTurnClass} ${selectedClass} ${captureClass}`\n      const key = `Cap-${sideNumber}-${name}-${i}`\n\n      const onClick = () => {\n        if (!isTurn) return\n        const clicked: number = turn * pieceId\n        gameState.clickPiece({ clicked, row: -1, column: -1, i })\n      }\n      return <div key={key} className={className} onClick={onClick} />\n    })\n    const className = `Captures-Inner Captures-${name}`\n    return <div className={className}>{children}</div>\n  }\n\n  function getSelectedClass(pieceId: Piece, index: number): string {\n    return !!selected &&\n      selected.piece &&\n      selected.row === -1 &&\n      selected.column === -1 &&\n      Math.abs(selected.piece) === pieceId /* TODO: すげー嫌 */ &&\n      selected.i === index\n      ? 'Piece-Selected'\n      : ''\n  }\n}\n\nexport default observer(Captures)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { Gote, Sente } from '../../model/shogi/Turn'\nimport { StoreContext } from '../../store/Store'\nimport Buttons from './Buttons'\nimport Captures from './Captures'\nimport './LeftSide.scss'\n\nconst LeftSide: FC = () => {\n  const { indexes, currentMove } = React.useContext(StoreContext).gameState\n  const { turn, cap0, cap1 } = currentMove.pos\n  const caps: number[] = indexes[0] === -1 ? cap1 : cap0\n  const isTurn: boolean = indexes[0] === -1 ? turn === Gote : turn === Sente\n\n  return (\n    <div className=\"LeftSide\">\n      <Captures isLeftSide={true} captures={caps} isTurn={isTurn} />\n      <div className=\"LeftInfo\">\n        <div />\n        <Buttons />\n      </div>\n    </div>\n  )\n}\n\nexport default observer(LeftSide)\n","import { observer } from 'mobx-react-lite'\nimport React, { FC, useEffect } from 'react'\nimport { intoView } from '../../handler/dom/intoView'\nimport Branch from '../../model/kifu/Branch'\nimport History, { isBranch, KifuComponent } from '../../model/kifu/History'\nimport { Move } from '../../model/kifu/Move'\nimport { StoreContext } from '../../store/Store'\nimport './Kifu.scss'\n\nconst CURRENT_KIFU_ELM_ID = 'Move-Current'\n\nconst Kifu: FC = () => {\n  const { gameState } = React.useContext(StoreContext)\n\n  useEffect(() => {\n    // 自動スクロール\n    // TODO: スマホで使いにくいし自前実装した方がいいかも\n    //       まぁスマホサポートしてないけど\n    intoView(CURRENT_KIFU_ELM_ID)\n  })\n\n  const { moves } = gameState.kifu.history\n  const elms: JSX.Element[] = renderKifu(moves, 0)\n  return (\n    <div className=\"KifuContainer\">\n      <div className=\"Kifu-Inner\">{elms}</div>\n    </div>\n  )\n\n  function renderKifu(moves: KifuComponent[], n: number): JSX.Element[] {\n    return moves.flatMap((kc: KifuComponent, i: number) => {\n      if (isBranch(kc)) return renderBranch(kc, n + i)\n      return renderMove(kc, n + i)\n    })\n  }\n\n  function renderBranch(b: Branch, n: number): JSX.Element[] {\n    const main: History = b.branches[b.index]\n    const [head, ...rest] = main.moves // head は必ず Move\n\n    const otherHeadsDom: JSX.Element[] = []\n    for (let i = 0; i < b.branches.length; i++) {\n      if (i === b.index) continue\n      const m: Move = b.branches[i].moves[0] as Move // head は必ず Move\n      const key: string = `${n}-${i}`\n      const txt: string = `-- ${kifuText(m)}`\n      const onClick = () => gameState.clickKifu(n, i)\n      otherHeadsDom.push(\n        <div key={key} className=\"Branch\" onClick={onClick}>\n          <span>{txt}</span>\n        </div>\n      )\n    }\n\n    const restDom = rest.length !== 0 ? renderKifu(rest, n + 1) : []\n\n    return [renderMove(head as Move, n)].concat(otherHeadsDom).concat(restDom)\n  }\n\n  function renderMove(m: Move, n: number): JSX.Element {\n    const { currentMove } = gameState\n    const id = currentMove.index === n ? CURRENT_KIFU_ELM_ID : undefined\n    const onClick = () => gameState.clickKifu(n)\n\n    return (\n      <div key={n} className=\"Move\" id={id} onClick={onClick}>\n        <div className=\"Number code\">{n + '.'}</div>\n        <div className=\"MoveText\">{kifuText(m)}</div>\n      </div>\n    )\n  }\n\n  function kifuText(m: Move): string {\n    const s = m.str\n    // 同 で始まっていて2文字だったら空白を入れる\n    if (s.length === 2 && s[0] === '同') return `同　${s[1]}`\n    return s\n  }\n}\n\nexport default observer(Kifu)\n","// ただ scrollIntoView を呼ぶだけ\nexport function intoView(id: string): void {\n  const current: HTMLElement | null = document.getElementById(id)\n  if (!current) return\n  if (!(current as any).scrollIntoViewIfNeeded) return\n  ;(current as any).scrollIntoViewIfNeeded()\n}\n","import { observer } from 'mobx-react-lite'\nimport React, { FC } from 'react'\nimport { Gote, Sente } from '../../model/shogi/Turn'\nimport { StoreContext } from '../../store/Store'\nimport Captures from './Captures'\nimport Kifu from './Kifu'\nimport './RightSide.scss'\n\nconst RightSide: FC = () => {\n  const { indexes, currentMove } = React.useContext(StoreContext).gameState\n  const { turn, cap0, cap1 } = currentMove.pos\n  const caps: number[] = indexes[0] === 9 ? cap1 : cap0\n  const isTurn: boolean = indexes[0] === 9 ? turn === Gote : turn === Sente\n\n  return (\n    <div className=\"RightSide\">\n      <div className=\"RightInfo\">\n        <Kifu />\n      </div>\n      <Captures isLeftSide={false} captures={caps} isTurn={isTurn} />\n    </div>\n  )\n}\n\nexport default observer(RightSide)\n","import React, { FC } from 'react'\nimport Board from './Board'\nimport './BoardArea.scss'\nimport LeftSide from './LeftSide'\nimport RightSide from './RightSide'\n\nconst BoardArea: FC = () => {\n  return (\n    <div className=\"BoardArea\">\n      <LeftSide />\n      <Board />\n      <RightSide />\n    </div>\n  )\n}\n\nexport default BoardArea\n","import { observer } from 'mobx-react-lite'\nimport React, { CSSProperties, FC } from 'react'\nimport { Thinking } from '../model/engine/State'\nimport { StoreContext } from '../store/Store'\nimport './App.scss'\nimport SideInfo from './engine/info/SideInfo'\nimport WidthController from './setting/WidthController'\nimport BoardArea from './shogi/BoardArea'\n\nconst App: FC = () => {\n  const { engineState, config } = React.useContext(StoreContext)\n  const { appWidth } = config\n\n  const isThinking: boolean = engineState.state === Thinking\n\n  const classes: string[] = ['App']\n  if (isThinking) classes.push('App-SideInfo')\n  else classes.push('App-BoardOnly')\n\n  if (appWidth) {\n    const w = (n: number) => {\n      if (isThinking) return (n * 2) / 3\n      return n\n    }\n    if (appWidth >= w(1500)) classes.push('Border-3')\n    if (appWidth >= w(800)) classes.push('Border-2')\n    classes.push('Border-1')\n  }\n\n  const className = classes.join(' ')\n  const style: CSSProperties = { width: appWidth ? `${appWidth}px` : '100%' }\n\n  return (\n    <div className=\"AppContainer\" style={style}>\n      <WidthController />\n      <div className={className}>\n        <BoardArea />\n        {isThinking ? <SideInfo /> : null}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(App)\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import ClipboardJS from 'clipboard'\n// https://github.com/mobxjs/mobx-react-lite/#observer-batching\nimport 'mobx-react-lite/batchingForReactDom'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './components/App'\nimport './index.scss'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(<App />, document.getElementById('root'))\nnew ClipboardJS('.Copy')\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.register()\n"],"sourceRoot":""}