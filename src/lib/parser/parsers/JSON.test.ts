import { JSONKifuParser } from './JSON'

// ちょっと適当
it('parse JSON to Kifu', () => {
  const obj = {
    meta: { version: '1', player: {}, handicap: '平手' },
    history: {
      moves: [
        {
          index: 0,
          str: '開始局面',
          pos: {
            pos: [
              [-2, -3, -4, -5, -8, -5, -4, -3, -2],
              [0, -6, 0, 0, 0, 0, 0, -7, 0],
              [-1, -1, -1, -1, -1, -1, -1, -1, -1],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [1, 1, 1, 1, 1, 1, 1, 1, 1],
              [0, 7, 0, 0, 0, 0, 0, 6, 0],
              [2, 3, 4, 5, 8, 5, 4, 3, 2],
            ],
            cap0: [0, 0, 0, 0, 0, 0, 0],
            cap1: [0, 0, 0, 0, 0, 0, 0],
            turn: 1,
            moveCount: 0,
          },
          source: { row: -1, column: -1 },
          dest: { row: -1, column: -1 },
          piece: 0,
        },
        {
          index: 1,
          str: '７六歩',
          pos: {
            pos: [
              [-2, -3, -4, -5, -8, -5, -4, -3, -2],
              [0, -6, 0, 0, 0, 0, 0, -7, 0],
              [-1, -1, -1, -1, -1, -1, -1, -1, -1],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 1, 0, 0],
              [1, 1, 1, 1, 1, 1, 0, 1, 1],
              [0, 7, 0, 0, 0, 0, 0, 6, 0],
              [2, 3, 4, 5, 8, 5, 4, 3, 2],
            ],
            cap0: [0, 0, 0, 0, 0, 0, 0],
            cap1: [0, 0, 0, 0, 0, 0, 0],
            turn: -1,
            moveCount: 1,
          },
          source: { row: 6, column: 6 },
          dest: { row: 5, column: 6 },
          piece: 1,
        },
        {
          index: 2,
          str: '３四歩',
          pos: {
            pos: [
              [-2, -3, -4, -5, -8, -5, -4, -3, -2],
              [0, -6, 0, 0, 0, 0, 0, -7, 0],
              [-1, -1, 0, -1, -1, -1, -1, -1, -1],
              [0, 0, -1, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 1, 0, 0],
              [1, 1, 1, 1, 1, 1, 0, 1, 1],
              [0, 7, 0, 0, 0, 0, 0, 6, 0],
              [2, 3, 4, 5, 8, 5, 4, 3, 2],
            ],
            cap0: [0, 0, 0, 0, 0, 0, 0],
            cap1: [0, 0, 0, 0, 0, 0, 0],
            turn: 1,
            moveCount: 2,
          },
          source: { row: 2, column: 2 },
          dest: { row: 3, column: 2 },
          piece: -1,
        },
        {
          index: 3,
          str: '２六歩',
          pos: {
            pos: [
              [-2, -3, -4, -5, -8, -5, -4, -3, -2],
              [0, -6, 0, 0, 0, 0, 0, -7, 0],
              [-1, -1, 0, -1, -1, -1, -1, -1, -1],
              [0, 0, -1, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 1, 0, 0, 0, 0, 1, 0, 0],
              [1, 0, 1, 1, 1, 1, 0, 1, 1],
              [0, 7, 0, 0, 0, 0, 0, 6, 0],
              [2, 3, 4, 5, 8, 5, 4, 3, 2],
            ],
            cap0: [0, 0, 0, 0, 0, 0, 0],
            cap1: [0, 0, 0, 0, 0, 0, 0],
            turn: -1,
            moveCount: 3,
          },
          source: { row: 6, column: 1 },
          dest: { row: 5, column: 1 },
          piece: 1,
        },
        {
          branches: [
            {
              moves: [
                {
                  index: 4,
                  str: '８四歩',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, -6, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, -1, -1, -1, -1, 0, -1],
                      [0, 0, -1, 0, 0, 0, 0, -1, 0],
                      [0, 0, 0, 0, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 0, 6, 0],
                      [2, 3, 4, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: 1,
                    moveCount: 4,
                  },
                  source: { row: 2, column: 7 },
                  dest: { row: 3, column: 7 },
                  piece: -1,
                },
                {
                  index: 5,
                  str: '２五歩',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, -6, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, -1, -1, -1, -1, 0, -1],
                      [0, 0, -1, 0, 0, 0, 0, -1, 0],
                      [0, 1, 0, 0, 0, 0, 0, 0, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 0, 6, 0],
                      [2, 3, 4, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: -1,
                    moveCount: 5,
                  },
                  source: { row: 5, column: 1 },
                  dest: { row: 4, column: 1 },
                  piece: 1,
                },
                {
                  index: 6,
                  str: '８五歩',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, -6, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, -1, -1, -1, -1, 0, -1],
                      [0, 0, -1, 0, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 0, -1, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 0, 6, 0],
                      [2, 3, 4, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: 1,
                    moveCount: 6,
                  },
                  source: { row: 3, column: 7 },
                  dest: { row: 4, column: 7 },
                  piece: -1,
                },
                {
                  index: 7,
                  str: '７八金',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, -6, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, -1, -1, -1, -1, 0, -1],
                      [0, 0, -1, 0, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 0, -1, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 5, 6, 0],
                      [2, 3, 4, 5, 8, 0, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: -1,
                    moveCount: 7,
                  },
                  source: { row: 8, column: 5 },
                  dest: { row: 7, column: 6 },
                  piece: 5,
                },
                {
                  index: 8,
                  str: '３二金',
                  pos: {
                    pos: [
                      [-2, -3, -4, 0, -8, -5, -4, -3, -2],
                      [0, -6, -5, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, -1, -1, -1, -1, 0, -1],
                      [0, 0, -1, 0, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 0, -1, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 5, 6, 0],
                      [2, 3, 4, 5, 8, 0, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: 1,
                    moveCount: 8,
                  },
                  source: { row: 0, column: 3 },
                  dest: { row: 1, column: 2 },
                  piece: -5,
                },
              ],
              index: 0,
            },
            {
              moves: [
                {
                  index: 4,
                  str: '４四歩',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, -6, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, 0, -1, -1, -1, -1, -1],
                      [0, 0, -1, -1, 0, 0, 0, 0, 0],
                      [0, 0, 0, 0, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 0, 6, 0],
                      [2, 3, 4, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: 1,
                    moveCount: 4,
                  },
                  source: { row: 2, column: 3 },
                  dest: { row: 3, column: 3 },
                  piece: -1,
                },
                {
                  index: 5,
                  str: '２五歩',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, -6, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, 0, 0, -1, -1, -1, -1, -1],
                      [0, 0, -1, -1, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 0, 0, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 0, 6, 0],
                      [2, 3, 4, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: -1,
                    moveCount: 5,
                  },
                  source: { row: 5, column: 1 },
                  dest: { row: 4, column: 1 },
                  piece: 1,
                },
                {
                  index: 6,
                  str: '３三角',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, 0, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, -6, 0, -1, -1, -1, -1, -1],
                      [0, 0, -1, -1, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 0, 0, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 0, 0, 0, 0, 6, 0],
                      [2, 3, 4, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: 1,
                    moveCount: 6,
                  },
                  source: { row: 1, column: 1 },
                  dest: { row: 2, column: 2 },
                  piece: -6,
                },
                {
                  index: 7,
                  str: '４八銀',
                  pos: {
                    pos: [
                      [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                      [0, 0, 0, 0, 0, 0, 0, -7, 0],
                      [-1, -1, -6, 0, -1, -1, -1, -1, -1],
                      [0, 0, -1, -1, 0, 0, 0, 0, 0],
                      [0, 1, 0, 0, 0, 0, 0, 0, 0],
                      [0, 0, 0, 0, 0, 0, 1, 0, 0],
                      [1, 0, 1, 1, 1, 1, 0, 1, 1],
                      [0, 7, 0, 4, 0, 0, 0, 6, 0],
                      [2, 3, 0, 5, 8, 5, 4, 3, 2],
                    ],
                    cap0: [0, 0, 0, 0, 0, 0, 0],
                    cap1: [0, 0, 0, 0, 0, 0, 0],
                    turn: -1,
                    moveCount: 7,
                  },
                  source: { row: 8, column: 2 },
                  dest: { row: 7, column: 3 },
                  piece: 4,
                },
                {
                  branches: [
                    {
                      moves: [
                        {
                          index: 8,
                          str: '３二銀',
                          pos: {
                            pos: [
                              [-2, -3, 0, -5, -8, -5, -4, -3, -2],
                              [0, 0, -4, 0, 0, 0, 0, -7, 0],
                              [-1, -1, -6, 0, -1, -1, -1, -1, -1],
                              [0, 0, -1, -1, 0, 0, 0, 0, 0],
                              [0, 1, 0, 0, 0, 0, 0, 0, 0],
                              [0, 0, 0, 0, 0, 0, 1, 0, 0],
                              [1, 0, 1, 1, 1, 1, 0, 1, 1],
                              [0, 7, 0, 4, 0, 0, 0, 6, 0],
                              [2, 3, 0, 5, 8, 5, 4, 3, 2],
                            ],
                            cap0: [0, 0, 0, 0, 0, 0, 0],
                            cap1: [0, 0, 0, 0, 0, 0, 0],
                            turn: 1,
                            moveCount: 8,
                          },
                          source: { row: 0, column: 2 },
                          dest: { row: 1, column: 2 },
                          piece: -4,
                        },
                      ],
                      index: 0,
                    },
                    {
                      moves: [
                        {
                          index: 8,
                          str: '４二飛',
                          pos: {
                            pos: [
                              [-2, -3, -4, -5, -8, -5, -4, -3, -2],
                              [0, 0, 0, -7, 0, 0, 0, 0, 0],
                              [-1, -1, -6, 0, -1, -1, -1, -1, -1],
                              [0, 0, -1, -1, 0, 0, 0, 0, 0],
                              [0, 1, 0, 0, 0, 0, 0, 0, 0],
                              [0, 0, 0, 0, 0, 0, 1, 0, 0],
                              [1, 0, 1, 1, 1, 1, 0, 1, 1],
                              [0, 7, 0, 4, 0, 0, 0, 6, 0],
                              [2, 3, 0, 5, 8, 5, 4, 3, 2],
                            ],
                            cap0: [0, 0, 0, 0, 0, 0, 0],
                            cap1: [0, 0, 0, 0, 0, 0, 0],
                            turn: 1,
                            moveCount: 8,
                          },
                          source: { row: 1, column: 7 },
                          dest: { row: 1, column: 3 },
                          piece: -7,
                        },
                      ],
                      index: 0,
                    },
                  ],
                  index: 1,
                },
              ],
              index: 4,
            },
          ],
          index: 1,
        },
      ],
      index: 4,
    },
  }

  const str = JSON.stringify(obj)

  const result = JSONKifuParser.parse(str)
  expect(result).not.toBeNull()

  const obj2 = JSON.parse(JSON.stringify(result?.value || ''))
  expect(obj2).toEqual(obj)
})
